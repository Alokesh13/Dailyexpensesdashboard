<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ledger Luxe | Multi-Dashboard Control</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      color-scheme: dark;
      --slate-950: #030712;
      --accent-rose: #f472b6;
      --accent-blue: #60a5fa;
      --accent-amber: #facc15;
    }
    
    body {
      font-family: 'Space Grotesk', sans-serif;
      background: radial-gradient(circle at top, rgba(250, 204, 21, 0.08), transparent 60%),
                  radial-gradient(circle at 20% 20%, rgba(96, 165, 250, 0.08), transparent 45%),
                  #020617;
      color: #f8fafc;
    }
    
    .glass {
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.85), rgba(15, 23, 42, 0.55));
      border: 1px solid rgba(148, 163, 184, 0.15);
      box-shadow: 0 10px 40px rgba(2, 6, 23, 0.65);
    }
    
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: rgba(15, 23, 42, 0.6); }
    ::-webkit-scrollbar-thumb { background: rgba(148, 163, 184, 0.5); border-radius: 999px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(248, 250, 252, 0.7); }
    
    .delete-btn {
      opacity: 0;
      transition: opacity 0.2s ease;
    }
    
    tr:hover .delete-btn {
      opacity: 1;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .nav-btn.active {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }
    
    .quick-add-form {
      transition: all 0.3s ease;
    }
    
    .quick-add-form:hover {
      transform: translateY(-2px);
    }
    
    .form-toggle {
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .form-toggle:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    
    .dashboard-item {
      transition: all 0.2s ease;
    }
    
    .dashboard-item:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    
    .dashboard-item.active {
      background: rgba(255, 255, 255, 0.1);
      border-left: 3px solid rgba(96, 165, 250, 1);
    }
    
    .currency-input {
      position: relative;
    }
    
    .currency-input input {
      padding-right: 60px;
    }
    
    .currency-label {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #94a3b8;
      font-size: 0.875rem;
    }
    
    .hidden {
      display: none;
    }
  </style>
</head>
<body class="min-h-screen">
  <div class="min-h-screen flex flex-col lg:flex-row">
    <!-- Sidebar -->
    <aside class="w-full lg:w-72 glass px-6 py-8 flex flex-col gap-10">
      <div>
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-amber-400 to-pink-500 flex items-center justify-center text-2xl font-bold text-slate-950 shadow-lg">
            LL
          </div>
          <div>
            <p class="text-lg font-semibold tracking-tight">Ledger Luxe</p>
            <p class="text-xs text-slate-400 uppercase tracking-[0.3em]">Multi-Dashboard</p>
          </div>
        </div>
        <div class="mt-6 text-sm text-slate-400 leading-relaxed">
          Create and manage multiple dashboards for personal, business, and project budgets.
        </div>
      </div>

      <nav class="space-y-3 text-sm font-semibold">
        <button class="nav-btn w-full flex items-center justify-between px-4 py-3 rounded-2xl bg-white/5 text-white active" data-tab="overview">
          <span>Overview</span>
          <span class="text-xs text-emerald-300 bg-emerald-500/10 px-2 py-0.5 rounded-full">Live</span>
        </button>
        <button class="nav-btn w-full flex items-center justify-between px-4 py-3 rounded-2xl hover:bg-white/5 transition text-slate-400" data-tab="expenses">
          <span>Expenses</span>
        </button>
        <button class="nav-btn w-full flex items-center justify-between px-4 py-3 rounded-2xl hover:bg-white/5 transition text-slate-400" data-tab="subscriptions">
          <span>Subscriptions</span>
        </button>
        <button class="nav-btn w-full flex items-center justify-between px-4 py-3 rounded-2xl hover:bg-white/5 transition text-slate-400" data-tab="budgets">
          <span>Budgets</span>
        </button>
        <button class="nav-btn w-full flex items-center justify-between px-4 py-3 rounded-2xl hover:bg-white/5 transition text-slate-400" data-tab="dashboards">
          <span>Dashboards</span>
        </button>
      </nav>

      <!-- Dashboard List -->
      <div class="space-y-2">
        <div class="flex items-center justify-between">
          <p class="text-sm text-slate-300 font-semibold">Your Dashboards</p>
          <button id="create-dashboard-btn" class="text-xs text-blue-300 hover:text-blue-200 transition">
            + New
          </button>
        </div>
        <div id="dashboard-list" class="space-y-1 max-h-40 overflow-y-auto">
          <!-- Dashboards will be dynamically added here -->
        </div>
      </div>

      <div class="mt-auto text-sm text-slate-400">
        <p class="text-slate-200 font-semibold mb-2">Storage</p>
        <div class="flex items-center justify-between text-xs mb-3">
          <span>Local data vault</span>
          <span id="last-updated" class="text-slate-300">--</span>
        </div>
        <div class="flex gap-2">
          <button id="reset-btn" class="flex-1 px-4 py-2 rounded-xl border border-white/10 text-xs tracking-wide uppercase text-rose-300 hover:bg-rose-500/10 transition">Reset</button>
          <button id="download-btn" class="flex-1 px-4 py-2 rounded-xl border border-white/10 text-xs tracking-wide uppercase text-blue-300 hover:bg-blue-500/10 transition">Download Data</button>
        </div>
      </div>
    </aside>

    <!-- Main Content Area -->
    <main class="flex-1 px-6 lg:px-10 py-8">
      <!-- Overview Tab -->
      <div id="overview" class="tab-content active space-y-10">
        <!-- Header -->
        <header class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
          <div>
            <p class="text-xs uppercase tracking-[0.4em] text-slate-400">Today · <span id="today-date">--</span></p>
            <h1 class="text-3xl md:text-4xl font-semibold tracking-tight mt-1">
              <span id="current-dashboard-name">Main Dashboard</span> Control
            </h1>
          </div>
          <div class="flex items-center gap-3">
            <div class="px-4 py-2 rounded-xl bg-white/5 text-sm">
              Total Balance Watch · <span class="font-semibold text-emerald-300" id="total-left">$0.00</span> left
            </div>
          </div>
        </header>

        <!-- Quick Add Section -->
        <section class="grid gap-6 lg:grid-cols-2">
          <!-- Quick Add Expense -->
          <div class="glass rounded-3xl p-6 space-y-4 quick-add-form">
            <div class="flex items-center justify-between">
              <h3 class="text-xl font-semibold">Quick Add Expense</h3>
              <button class="form-toggle text-slate-400 hover:text-white p-2 rounded-xl" id="toggle-expense-form">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
              </button>
            </div>
            <form id="quick-expense-form" class="space-y-4 transition-all duration-300">
              <div class="grid gap-4 grid-cols-2">
                <label class="flex flex-col gap-1 text-sm">
                  <span class="text-xs text-slate-400">Description</span>
                  <input name="description" required placeholder="Lunch, supplies..." class="mt-1 bg-white/5 border border-white/10 rounded-xl px-3 py-2 text-sm focus:outline-none focus:border-rose-200">
                </label>
                <label class="flex flex-col gap-1 text-sm currency-input">
                  <span class="text-xs text-slate-400">Amount</span>
                  <input type="number" step="0.01" min="0" name="amount" required class="mt-1 bg-white/5 border border-white/10 rounded-xl px-3 py-2 text-sm focus:outline-none focus:border-rose-200">
                  <span class="currency-label">USD</span>
                </label>
              </div>
              <div class="grid gap-4 grid-cols-2">
                <label class="flex flex-col gap-1 text-sm">
                  <span class="text-xs text-slate-400">Scope</span>
                  <select name="scope" class="mt-1 bg-white/5 border border-white/10 rounded-xl px-3 py-2 text-sm focus:outline-none focus:border-rose-200" required id="quick-expense-scope">
                    <option value="personal">Personal</option>
                    <option value="business">Business</option>
                  </select>
                </label>
                <label class="flex flex-col gap-1 text-sm">
                  <span class="text-xs text-slate-400">Category</span>
                  <select name="category" class="mt-1 bg-white/5 border border-white/10 rounded-xl px-3 py-2 text-sm focus:outline-none focus:border-rose-200" required id="quick-expense-category">
                    <!-- Personal categories will be loaded by default -->
                    <option value="Food & Dining">Food & Dining</option>
                    <option value="Transportation">Transportation</option>
                    <option value="Entertainment">Entertainment</option>
                    <option value="Shopping">Shopping</option>
                    <option value="Healthcare">Healthcare</option>
                    <option value="Education">Education</option>
                    <option value="Personal Care">Personal Care</option>
                    <option value="Gifts & Donations">Gifts & Donations</option>
                    <option value="Other">Other</option>
                  </select>
                </label>
              </div>
              <button type="submit" class="w-full bg-gradient-to-r from-rose-400 to-amber-300 text-slate-900 font-semibold py-2 rounded-xl text-sm shadow-lg shadow-rose-500/30">Add Expense</button>
            </form>
          </div>

          <!-- Quick Add Subscription -->
          <div class="glass rounded-3xl p-6 space-y-4 quick-add-form">
            <div class="flex items-center justify-between">
              <h3 class="text-xl font-semibold">Quick Add Subscription</h3>
              <button class="form-toggle text-slate-400 hover:text-white p-2 rounded-xl" id="toggle-subscription-form">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
              </button>
            </div>
            <form id="quick-subscription-form" class="space-y-4 transition-all duration-300">
              <div class="grid gap-4 grid-cols-2">
                <label class="flex flex-col gap-1 text-sm">
                  <span class="text-xs text-slate-400">Name</span>
                  <input name="name" required placeholder="Netflix, Spotify..." class="mt-1 bg-white/5 border border-white/10 rounded-xl px-3 py-2 text-sm focus:outline-none focus:border-sky-200">
                </label>
                <label class="flex flex-col gap-1 text-sm currency-input">
                  <span class="text-xs text-slate-400">Amount</span>
                  <input type="number" step="0.01" min="0" name="amount" required class="mt-1 bg-white/5 border border-white/10 rounded-xl px-3 py-2 text-sm focus:outline-none focus:border-sky-200">
                  <span class="currency-label">USD</span>
                </label>
              </div>
              <div class="grid gap-4 grid-cols-2">
                <label class="flex flex-col gap-1 text-sm">
                  <span class="text-xs text-slate-400">Scope</span>
                  <select name="scope" class="mt-1 bg-white/5 border border-white/10 rounded-xl px-3 py-2 text-sm focus:outline-none focus:border-sky-200" required id="quick-subscription-scope">
                    <option value="personal">Personal</option>
                    <option value="business">Business</option>
                  </select>
                </label>
                <label class="flex flex-col gap-1 text-sm">
                  <span class="text-xs text-slate-400">Category</span>
                  <select name="category" class="mt-1 bg-white/5 border border-white/10 rounded-xl px-3 py-2 text-sm focus:outline-none focus:border-sky-200" required id="quick-subscription-category">
                    <!-- Personal categories will be loaded by default -->
                    <option value="Streaming">Streaming</option>
                    <option value="Music">Music</option>
                    <option value="Fitness">Fitness</option>
                    <option value="News">News</option>
                    <option value="Cloud Storage">Cloud Storage</option>
                    <option value="Gaming">Gaming</option>
                    <option value="Other">Other</option>
                  </select>
                </label>
              </div>
              <div class="grid gap-4 grid-cols-2">
                <label class="flex flex-col gap-1 text-sm">
                  <span class="text-xs text-slate-400">Billing</span>
                  <select name="billing" class="mt-1 bg-white/5 border border-white/10 rounded-xl px-3 py-2 text-sm focus:outline-none focus:border-sky-200" required>
                    <option value="Monthly">Monthly</option>
                    <option value="Quarterly">Quarterly</option>
                    <option value="Annual">Annual</option>
                  </select>
                </label>
              </div>
              <button type="submit" class="w-full bg-gradient-to-r from-sky-400 to-indigo-500 text-white font-semibold py-2 rounded-xl text-sm shadow-lg shadow-sky-500/30">Add Subscription</button>
            </form>
          </div>
        </section>

        <!-- Highlights -->
        <section class="grid gap-6 lg:grid-cols-4">
          <div class="glass rounded-2xl p-5">
            <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Personal Spend</p>
            <p class="text-3xl font-semibold mt-2" id="personal-spent">$0.00</p>
            <p class="text-emerald-300 text-sm mt-1" id="personal-count">0 entries</p>
          </div>
          <div class="glass rounded-2xl p-5">
            <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Business Spend</p>
            <p class="text-3xl font-semibold mt-2" id="business-spent">$0.00</p>
            <p class="text-blue-300 text-sm mt-1" id="business-count">0 entries</p>
          </div>
          <div class="glass rounded-2xl p-5">
            <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Subscriptions Active</p>
            <p class="text-3xl font-semibold mt-2" id="subscription-count">0</p>
            <p class="text-slate-300 text-sm mt-1" id="subscription-total">$0.00 / mo</p>
          </div>
          <div class="glass rounded-2xl p-5">
            <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Total Burn</p>
            <p class="text-3xl font-semibold mt-2" id="total-spent">$0.00</p>
            <p class="text-slate-300 text-sm mt-1" id="burn-rate">—</p>
          </div>
        </section>

        <!-- Budget Status -->
        <section class="grid gap-6 xl:grid-cols-[1.1fr_0.9fr]">
          <div class="glass rounded-3xl p-6 space-y-6">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm uppercase tracking-[0.4em] text-slate-400">Budget Inputs</p>
                <h2 class="text-xl font-semibold">Personal vs Business allocations</h2>
              </div>
              <span class="text-xs text-slate-400">Autosave on apply</span>
            </div>
            <form id="budget-form" class="grid gap-4 md:grid-cols-2">
              <label class="flex flex-col gap-2">
                <span class="text-sm text-slate-300">Personal Budget (USD)</span>
                <input type="number" step="0.01" min="0" name="personalBudget" class="bg-white/5 border border-white/10 rounded-2xl px-4 py-3 focus:outline-none focus:border-amber-300/60" required>
              </label>
              <label class="flex flex-col gap-2">
                <span class="text-sm text-slate-300">Business Budget (USD)</span>
                <input type="number" step="0.01" min="0" name="businessBudget" class="bg-white/5 border border-white/10 rounded-2xl px-4 py-3 focus:outline-none focus:border-sky-300/60" required>
              </label>
              <button type="submit" class="md:col-span-2 bg-gradient-to-r from-emerald-400 to-blue-500 text-slate-900 font-semibold py-3 rounded-2xl shadow-lg shadow-emerald-500/30">Apply Budgets</button>
            </form>
          </div>
          <div class="glass rounded-3xl p-6 grid gap-6 text-sm">
            <div>
              <p class="text-slate-400 uppercase tracking-[0.4em] text-xs">Status</p>
              <h3 class="text-2xl font-semibold mt-2" id="status-balance">Calibrating…</h3>
              <p class="text-slate-400 mt-1">Real-time health of your dual portfolio.</p>
            </div>
            <div class="space-y-4">
              <div>
                <div class="flex items-center justify-between text-xs uppercase mb-1 text-slate-400">
                  <span>Personal Budget Used</span>
                  <span id="personal-percent">0%</span>
                </div>
                <div class="w-full h-2 rounded-full bg-white/5 overflow-hidden">
                  <div id="personal-bar" class="h-full bg-gradient-to-r from-rose-400 to-amber-300" style="width:0%"></div>
                </div>
              </div>
              <div>
                <div class="flex items-center justify-between text-xs uppercase mb-1 text-slate-400">
                  <span>Business Budget Used</span>
                  <span id="business-percent">0%</span>
                </div>
                <div class="w-full h-2 rounded-full bg-white/5 overflow-hidden">
                  <div id="business-bar" class="h-full bg-gradient-to-r from-sky-400 to-emerald-300" style="width:0%"></div>
                </div>
              </div>
            </div>
            <div class="grid grid-cols-2 gap-4 text-center">
              <div class="rounded-2xl bg-white/5 p-4">
                <p class="text-slate-400 text-xs uppercase tracking-[0.3em]">Personal left</p>
                <p class="text-xl font-semibold mt-1" id="personal-left">$0.00</p>
              </div>
              <div class="rounded-2xl bg-white/5 p-4">
                <p class="text-slate-400 text-xs uppercase tracking-[0.3em]">Business left</p>
                <p class="text-xl font-semibold mt-1" id="business-left">$0.00</p>
              </div>
            </div>
          </div>
        </section>

        <!-- Charts -->
        <section class="grid gap-6 xl:grid-cols-2">
          <div class="glass rounded-3xl p-6">
            <div class="flex items-center justify-between mb-6">
              <div>
                <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Combined Overview</p>
                <h3 class="text-2xl font-semibold">Budget vs spent</h3>
              </div>
              <span class="text-xs text-slate-400">USD</span>
            </div>
            <div class="h-72">
              <canvas id="combinedChart"></canvas>
            </div>
          </div>
          <div class="grid gap-6">
            <div class="glass rounded-3xl p-6">
              <div class="flex items-center justify-between mb-6">
                <div>
                  <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Personal Mix</p>
                  <h3 class="text-2xl font-semibold">Categories snapshot</h3>
                </div>
                <span class="text-emerald-300 text-sm" id="personal-mix-total">$0.00</span>
              </div>
              <div class="h-64">
                <canvas id="personalChart"></canvas>
              </div>
            </div>
            <div class="glass rounded-3xl p-6">
              <div class="flex items-center justify-between mb-6">
                <div>
                  <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Business Mix</p>
                  <h3 class="text-2xl font-semibold">Categories snapshot</h3>
                </div>
                <span class="text-blue-300 text-sm" id="business-mix-total">$0.00</span>
              </div>
              <div class="h-64">
                <canvas id="businessChart"></canvas>
              </div>
            </div>
          </div>
        </section>

        <!-- Recent Activity -->
        <section class="grid gap-6 lg:grid-cols-2">
          <div class="glass rounded-3xl p-6">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-2xl font-semibold">Recent Expenses</h3>
              <span class="text-sm text-slate-400">Latest 5</span>
            </div>
            <div class="overflow-x-auto">
              <table class="w-full text-sm text-left">
                <thead class="text-slate-400 uppercase text-xs">
                  <tr>
                    <th class="py-2">Item</th>
                    <th class="py-2">Scope</th>
                    <th class="py-2">Category</th>
                    <th class="py-2 text-right">Amount</th>
                  </tr>
                </thead>
                <tbody id="recent-expense-table" class="divide-y divide-white/5"></tbody>
              </table>
            </div>
          </div>
          <div class="glass rounded-3xl p-6">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-2xl font-semibold">Upcoming Subscriptions</h3>
              <span class="text-sm text-slate-400">Next 5</span>
            </div>
            <div class="overflow-x-auto">
              <table class="w-full text-sm text-left">
                <thead class="text-slate-400 uppercase text-xs">
                  <tr>
                    <th class="py-2">Service</th>
                    <th class="py-2">Scope</th>
                    <th class="py-2">Category</th>
                    <th class="py-2">Billing</th>
                    <th class="py-2 text-right">Amount</th>
                  </tr>
                </thead>
                <tbody id="recent-subscription-table" class="divide-y divide-white/5"></tbody>
              </table>
            </div>
          </div>
        </section>
      </div>

      <!-- Expenses Tab -->
      <div id="expenses" class="tab-content space-y-10">
        <header class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
          <div>
            <p class="text-xs uppercase tracking-[0.4em] text-slate-400">Expense Management</p>
            <h1 class="text-3xl md:text-4xl font-semibold tracking-tight mt-1">Expense Ledger</h1>
          </div>
          <div class="flex items-center gap-3">
            <div class="px-4 py-2 rounded-xl bg-white/5 text-sm">
              Total Expenses · <span class="font-semibold text-rose-300" id="expenses-total">$0.00</span>
            </div>
          </div>
        </header>

        <section class="grid gap-6 xl:grid-cols-2">
          <div class="glass rounded-3xl p-6 space-y-4">
            <div>
              <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Add Expense</p>
              <h3 class="text-2xl font-semibold">Log personal or business cost</h3>
            </div>
            <form id="expense-form" class="space-y-4">
              <div class="grid gap-4 sm:grid-cols-2">
                <label class="flex flex-col gap-1 text-sm">
                  Description
                  <input name="description" required placeholder="Dinner, ad spend…" class="mt-1 bg-white/5 border border-white/10 rounded-2xl px-4 py-3 focus:outline-none focus:border-rose-200">
                </label>
                <label class="flex flex-col gap-1 text-sm currency-input">
                  Amount
                  <input type="number" step="0.01" min="0" name="amount" required class="mt-1 bg-white/5 border border-white/10 rounded-2xl px-4 py-3 focus:outline-none focus:border-rose-200">
                  <span class="currency-label">USD</span>
                </label>
              </div>
              <div class="grid gap-4 sm:grid-cols-2">
                <label class="flex flex-col gap-1 text-sm">
                  Scope
                  <select name="scope" class="mt-1 bg-white/5 border border-white/10 rounded-2xl px-4 py-3 focus:outline-none focus:border-rose-200" required id="expense-scope">
                    <option value="personal">Personal</option>
                    <option value="business">Business</option>
                  </select>
                </label>
                <label class="flex flex-col gap-1 text-sm">
                  Category
                  <select name="category" class="mt-1 bg-white/5 border border-white/10 rounded-2xl px-4 py-3 focus:outline-none focus:border-rose-200" required id="expense-category">
                    <!-- Personal categories will be loaded by default -->
                    <option value="Food & Dining">Food & Dining</option>
                    <option value="Transportation">Transportation</option>
                    <option value="Entertainment">Entertainment</option>
                    <option value="Shopping">Shopping</option>
                    <option value="Healthcare">Healthcare</option>
                    <option value="Education">Education</option>
                    <option value="Personal Care">Personal Care</option>
                    <option value="Gifts & Donations">Gifts & Donations</option>
                    <option value="Other">Other</option>
                  </select>
                </label>
              </div>
              <label class="flex flex-col gap-1 text-sm">
                Date
                <input type="date" name="date" data-today class="mt-1 bg-white/5 border border-white/10 rounded-2xl px-4 py-3 focus:outline-none focus:border-rose-200" required>
              </label>
              <button type="submit" class="w-full bg-gradient-to-r from-rose-400 via-amber-300 to-yellow-200 text-slate-900 font-semibold py-3 rounded-2xl shadow-lg shadow-rose-500/30">Add Expense</button>
            </form>
          </div>

          <div class="space-y-6">
            <div class="glass rounded-3xl p-6">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-2xl font-semibold">All Expenses</h3>
                <span class="text-sm text-slate-400" id="expense-count">0 entries</span>
              </div>
              <div class="overflow-x-auto max-h-[500px]">
                <table class="w-full text-sm text-left">
                  <thead class="text-slate-400 uppercase text-xs sticky top-0 bg-slate-900/80 backdrop-blur">
                    <tr>
                      <th class="py-2">Item</th>
                      <th class="py-2">Scope</th>
                      <th class="py-2">Category</th>
                      <th class="py-2 text-right">Amount</th>
                      <th class="py-2 text-right">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="expense-table" class="divide-y divide-white/5"></tbody>
                </table>
              </div>
            </div>

            <div class="glass rounded-3xl p-6">
              <div class="flex items-center justify-between mb-6">
                <div>
                  <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Expense Analytics</p>
                  <h3 class="text-2xl font-semibold">Spending Trends</h3>
                </div>
                <span class="text-xs text-slate-400">Last 30 days</span>
              </div>
              <div class="h-64">
                <canvas id="expensesTrendChart"></canvas>
              </div>
            </div>
          </div>
        </section>
      </div>

      <!-- Subscriptions Tab -->
      <div id="subscriptions" class="tab-content space-y-10">
        <header class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
          <div>
            <p class="text-xs uppercase tracking-[0.4em] text-slate-400">Subscription Management</p>
            <h1 class="text-3xl md:text-4xl font-semibold tracking-tight mt-1">Subscription Deck</h1>
          </div>
          <div class="flex items-center gap-3">
            <div class="px-4 py-2 rounded-xl bg-white/5 text-sm">
              Monthly Total · <span class="font-semibold text-blue-300" id="subscriptions-total">$0.00</span>
            </div>
          </div>
        </header>

        <section class="grid gap-6 xl:grid-cols-2">
          <div class="glass rounded-3xl p-6 space-y-4">
            <div>
              <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Add Subscription</p>
              <h3 class="text-2xl font-semibold">Recurring tools & memberships</h3>
            </div>
            <form id="subscription-form" class="space-y-4">
              <div class="grid gap-4 sm:grid-cols-2">
                <label class="flex flex-col gap-1 text-sm">
                  Name
                  <input name="name" required placeholder="Notion, Canva Pro…" class="mt-1 bg-white/5 border border-white/10 rounded-2xl px-4 py-3 focus:outline-none focus:border-sky-200">
                </label>
                <label class="flex flex-col gap-1 text-sm currency-input">
                  Amount
                  <input type="number" step="0.01" min="0" name="amount" required class="mt-1 bg-white/5 border border-white/10 rounded-2xl px-4 py-3 focus:outline-none focus:border-sky-200">
                  <span class="currency-label">USD</span>
                </label>
              </div>
              <div class="grid gap-4 sm:grid-cols-2">
                <label class="flex flex-col gap-1 text-sm">
                  Scope
                  <select name="scope" class="mt-1 bg-white/5 border border-white/10 rounded-2xl px-4 py-3 focus:outline-none focus:border-sky-200" required id="subscription-scope">
                    <option value="personal">Personal</option>
                    <option value="business">Business</option>
                  </select>
                </label>
                <label class="flex flex-col gap-1 text-sm">
                  Category
                  <select name="category" class="mt-1 bg-white/5 border border-white/10 rounded-2xl px-4 py-3 focus:outline-none focus:border-sky-200" required id="subscription-category">
                    <!-- Personal categories will be loaded by default -->
                    <option value="Streaming">Streaming</option>
                    <option value="Music">Music</option>
                    <option value="Fitness">Fitness</option>
                    <option value="News">News</option>
                    <option value="Cloud Storage">Cloud Storage</option>
                    <option value="Gaming">Gaming</option>
                    <option value="Other">Other</option>
                  </select>
                </label>
              </div>
              <div class="grid gap-4 sm:grid-cols-2">
                <label class="flex flex-col gap-1 text-sm">
                  Billing Cycle
                  <select name="billing" class="mt-1 bg-white/5 border border-white/10 rounded-2xl px-4 py-3 focus:outline-none focus:border-sky-200" required>
                    <option value="Monthly">Monthly</option>
                    <option value="Quarterly">Quarterly</option>
                    <option value="Annual">Annual</option>
                  </select>
                </label>
                <label class="flex flex-col gap-1 text-sm">
                  Next Charge Date
                  <input type="date" name="date" data-today class="mt-1 bg-white/5 border border-white/10 rounded-2xl px-4 py-3 focus:outline-none focus:border-sky-200" required>
                </label>
              </div>
              <button type="submit" class="w-full bg-gradient-to-r from-sky-400 via-violet-400 to-indigo-500 text-white font-semibold py-3 rounded-2xl shadow-lg shadow-sky-500/30">Add Subscription</button>
            </form>
          </div>

          <div class="space-y-6">
            <div class="glass rounded-3xl p-6">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-2xl font-semibold">All Subscriptions</h3>
                <span class="text-sm text-slate-400" id="subscription-page-count">0 entries</span>
              </div>
              <div class="overflow-x-auto max-h-[500px]">
                <table class="w-full text-sm text-left">
                  <thead class="text-slate-400 uppercase text-xs sticky top-0 bg-slate-900/80 backdrop-blur">
                    <tr>
                      <th class="py-2">Service</th>
                      <th class="py-2">Scope</th>
                      <th class="py-2">Category</th>
                      <th class="py-2">Billing</th>
                      <th class="py-2 text-right">Amount</th>
                      <th class="py-2 text-right">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="subscription-table" class="divide-y divide-white/5"></tbody>
                </table>
              </div>
            </div>

            <div class="glass rounded-3xl p-6">
              <div class="flex items-center justify-between mb-6">
                <div>
                  <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Subscription Analytics</p>
                  <h3 class="text-2xl font-semibold">Cost Distribution</h3>
                </div>
                <span class="text-xs text-slate-400">By billing cycle</span>
              </div>
              <div class="h-64">
                <canvas id="subscriptionsChart"></canvas>
              </div>
            </div>
          </div>
        </section>
      </div>

      <!-- Budgets Tab -->
      <div id="budgets" class="tab-content space-y-10">
        <header class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
          <div>
            <p class="text-xs uppercase tracking-[0.4em] text-slate-400">Budget Management</p>
            <h1 class="text-3xl md:text-4xl font-semibold tracking-tight mt-1">Budget Controls</h1>
          </div>
          <div class="flex items-center gap-3">
            <div class="px-4 py-2 rounded-xl bg-white/5 text-sm">
              Combined Budget · <span class="font-semibold text-emerald-300" id="combined-budget">$0.00</span>
            </div>
          </div>
        </header>

        <section class="grid gap-6 xl:grid-cols-[1.1fr_0.9fr]">
          <div class="glass rounded-3xl p-6 space-y-6">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm uppercase tracking-[0.4em] text-slate-400">Budget Inputs</p>
                <h2 class="text-xl font-semibold">Personal vs Business allocations</h2>
              </div>
              <span class="text-xs text-slate-400">Autosave on apply</span>
            </div>
            <form id="budgets-budget-form" class="grid gap-4 md:grid-cols-2">
              <label class="flex flex-col gap-2">
                <span class="text-sm text-slate-300">Personal Budget (USD)</span>
                <input type="number" step="0.01" min="0" name="personalBudget" class="bg-white/5 border border-white/10 rounded-2xl px-4 py-3 focus:outline-none focus:border-amber-300/60" required>
              </label>
              <label class="flex flex-col gap-2">
                <span class="text-sm text-slate-300">Business Budget (USD)</span>
                <input type="number" step="0.01" min="0" name="businessBudget" class="bg-white/5 border border-white/10 rounded-2xl px-4 py-3 focus:outline-none focus:border-sky-300/60" required>
              </label>
              <button type="submit" class="md:col-span-2 bg-gradient-to-r from-emerald-400 to-blue-500 text-slate-900 font-semibold py-3 rounded-2xl shadow-lg shadow-emerald-500/30">Apply Budgets</button>
            </form>
          </div>
          <div class="glass rounded-3xl p-6 grid gap-6 text-sm">
            <div>
              <p class="text-slate-400 uppercase tracking-[0.4em] text-xs">Status</p>
              <h3 class="text-2xl font-semibold mt-2" id="budgets-status-balance">Calibrating…</h3>
              <p class="text-slate-400 mt-1">Real-time health of your dual portfolio.</p>
            </div>
            <div class="space-y-4">
              <div>
                <div class="flex items-center justify-between text-xs uppercase mb-1 text-slate-400">
                  <span>Personal Budget Used</span>
                  <span id="budgets-personal-percent">0%</span>
                </div>
                <div class="w-full h-2 rounded-full bg-white/5 overflow-hidden">
                  <div id="budgets-personal-bar" class="h-full bg-gradient-to-r from-rose-400 to-amber-300" style="width:0%"></div>
                </div>
              </div>
              <div>
                <div class="flex items-center justify-between text-xs uppercase mb-1 text-slate-400">
                  <span>Business Budget Used</span>
                  <span id="budgets-business-percent">0%</span>
                </div>
                <div class="w-full h-2 rounded-full bg-white/5 overflow-hidden">
                  <div id="budgets-business-bar" class="h-full bg-gradient-to-r from-sky-400 to-emerald-300" style="width:0%"></div>
                </div>
              </div>
            </div>
            <div class="grid grid-cols-2 gap-4 text-center">
              <div class="rounded-2xl bg-white/5 p-4">
                <p class="text-slate-400 text-xs uppercase tracking-[0.3em]">Personal left</p>
                <p class="text-xl font-semibold mt-1" id="budgets-personal-left">$0.00</p>
              </div>
              <div class="rounded-2xl bg-white/5 p-4">
                <p class="text-slate-400 text-xs uppercase tracking-[0.3em]">Business left</p>
                <p class="text-xl font-semibold mt-1" id="budgets-business-left">$0.00</p>
              </div>
            </div>
          </div>
        </section>

        <section class="glass rounded-3xl p-6">
          <div class="flex items-center justify-between mb-6">
            <div>
              <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Budget Analytics</p>
              <h3 class="text-2xl font-semibold">Budget vs spent overview</h3>
            </div>
            <span class="text-xs text-slate-400">USD</span>
          </div>
          <div class="h-72">
            <canvas id="budgets-combinedChart"></canvas>
          </div>
        </section>
      </div>

      <!-- Dashboards Tab -->
      <div id="dashboards" class="tab-content space-y-10">
        <header class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
          <div>
            <p class="text-xs uppercase tracking-[0.4em] text-slate-400">Dashboard Management</p>
            <h1 class="text-3xl md:text-4xl font-semibold tracking-tight mt-1">Multi-Dashboard Control</h1>
          </div>
          <div class="flex items-center gap-3">
            <button class="p-3 rounded-2xl bg-gradient-to-r from-purple-500 to-amber-400 text-slate-950 font-semibold shadow-lg shadow-amber-500/30 text-sm" id="create-dashboard-main">Create Dashboard</button>
          </div>
        </header>

        <section class="grid gap-6 lg:grid-cols-2">
          <div class="glass rounded-3xl p-6 space-y-6">
            <div>
              <h3 class="text-2xl font-semibold">Create New Dashboard</h3>
              <p class="text-slate-400 mt-1">Set up a new dashboard for different projects or purposes.</p>
            </div>
            <form id="create-dashboard-form" class="space-y-4">
              <label class="flex flex-col gap-2">
                <span class="text-sm text-slate-300">Dashboard Name</span>
                <input type="text" name="name" required placeholder="e.g., Personal, Business, Project X" class="bg-white/5 border border-white/10 rounded-2xl px-4 py-3 focus:outline-none focus:border-blue-300/60">
              </label>
              <label class="flex flex-col gap-2">
                <span class="text-sm text-slate-300">Description (Optional)</span>
                <textarea name="description" rows="3" placeholder="What is this dashboard for?" class="bg-white/5 border border-white/10 rounded-2xl px-4 py-3 focus:outline-none focus:border-blue-300/60"></textarea>
              </label>
              <div class="grid gap-4 md:grid-cols-2">
                <label class="flex flex-col gap-2">
                  <span class="text-sm text-slate-300">Initial Personal Budget</span>
                  <input type="number" step="0.01" min="0" name="personalBudget" class="bg-white/5 border border-white/10 rounded-2xl px-4 py-3 focus:outline-none focus:border-amber-300/60">
                </label>
                <label class="flex flex-col gap-2">
                  <span class="text-sm text-slate-300">Initial Business Budget</span>
                  <input type="number" step="0.01" min="0" name="businessBudget" class="bg-white/5 border border-white/10 rounded-2xl px-4 py-3 focus:outline-none focus:border-sky-300/60">
                </label>
              </div>
              <button type="submit" class="w-full bg-gradient-to-r from-blue-400 to-indigo-500 text-white font-semibold py-3 rounded-2xl shadow-lg shadow-blue-500/30">Create Dashboard</button>
            </form>
          </div>

          <div class="glass rounded-3xl p-6">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-2xl font-semibold">Your Dashboards</h3>
              <span class="text-sm text-slate-400" id="dashboard-count">0 dashboards</span>
            </div>
            <div class="space-y-4" id="dashboard-management-list">
              <!-- Dashboards will be dynamically added here -->
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <script>
    const STORAGE_KEY = 'ledger_luxe_multi_dashboard_v2';
    
    // Define categories for expenses and subscriptions
    const categories = {
      expense: {
        personal: [
          'Food & Dining',
          'Transportation',
          'Entertainment',
          'Shopping',
          'Healthcare',
          'Education',
          'Personal Care',
          'Gifts & Donations',
          'Housing',
          'Utilities',
          'Insurance',
          'Travel',
          'Other'
        ],
        business: [
          'Office Supplies',
          'Software & Tools',
          'Marketing & Advertising',
          'Travel & Accommodation',
          'Professional Services',
          'Rent & Utilities',
          'Equipment',
          'Training & Development',
          'Insurance',
          'Bank Fees',
          'Taxes',
          'Shipping',
          'Other'
        ]
      },
      subscription: {
        personal: [
          'Streaming Services',
          'Music',
          'Fitness & Wellness',
          'News & Publications',
          'Cloud Storage',
          'Gaming',
          'Educational',
          'Productivity Tools',
          'Security Software',
          'Other'
        ],
        business: [
          'SaaS Tools',
          'Hosting & Domains',
          'Analytics',
          'Security',
          'Communication',
          'Project Management',
          'CRM',
          'Accounting',
          'Marketing Tools',
          'Other'
        ]
      }
    };

    const dashboardDefaults = {
      id: 'default',
      name: 'Main Dashboard',
      description: 'Your primary budget dashboard',
      createdAt: new Date().toISOString(),
      budgets: {
        personal: 0,
        business: 0
      },
      expenses: [],
      subscriptions: []
    };

    let state = {
      currentDashboardId: 'default',
      dashboards: {
        'default': { ...dashboardDefaults }
      }
    };

    let combinedChart, personalChart, businessChart, budgetsCombinedChart;
    let expensesTrendChart, subscriptionsChart;

    const formatCurrency = (val) => val.toLocaleString('en-US', { style: 'currency', currency: 'USD' });

    function getCurrentDashboard() {
      return state.dashboards[state.currentDashboardId];
    }

    function saveState() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      document.getElementById('last-updated').textContent = new Date().toLocaleTimeString();
    }

    function loadState() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        state = JSON.parse(saved);
      } else {
        state = {
          currentDashboardId: 'default',
          dashboards: {
            'default': { ...dashboardDefaults }
          }
        };
      }
    }

    function updateCategoryOptions(scopeSelectId, categorySelectId, type) {
      const scopeSelect = document.getElementById(scopeSelectId);
      const categorySelect = document.getElementById(categorySelectId);
      const scope = scopeSelect.value;
      
      // Clear existing options
      categorySelect.innerHTML = '';
      
      // Add new options based on scope and type
      categories[type][scope].forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        categorySelect.appendChild(option);
      });
    }

    function getScopeTotals(scope) {
      const dashboard = getCurrentDashboard();
      const expenseTotal = dashboard.expenses.filter(e => e.scope === scope).reduce((sum, e) => sum + Number(e.amount), 0);
      const subTotal = dashboard.subscriptions.filter(s => s.scope === scope).reduce((sum, s) => sum + Number(s.amount), 0);
      return expenseTotal + subTotal;
    }

    function renderHighlights() {
      const dashboard = getCurrentDashboard();
      const personalSpent = getScopeTotals('personal');
      const businessSpent = getScopeTotals('business');
      const totalSpent = personalSpent + businessSpent;
      const personalEntries = dashboard.expenses.filter(e => e.scope === 'personal').length + dashboard.subscriptions.filter(s => s.scope === 'personal').length;
      const businessEntries = dashboard.expenses.filter(e => e.scope === 'business').length + dashboard.subscriptions.filter(s => s.scope === 'business').length;

      document.getElementById('personal-spent').textContent = formatCurrency(personalSpent);
      document.getElementById('business-spent').textContent = formatCurrency(businessSpent);
      document.getElementById('total-spent').textContent = formatCurrency(totalSpent);
      document.getElementById('personal-count').textContent = `${personalEntries} entries`;
      document.getElementById('business-count').textContent = `${businessEntries} entries`;
      document.getElementById('subscription-count').textContent = dashboard.subscriptions.length;
      const monthlySubs = dashboard.subscriptions.reduce((sum, s) => sum + Number(s.amount), 0);
      document.getElementById('subscription-total').textContent = `${formatCurrency(monthlySubs)} / cycle`;
      document.getElementById('burn-rate').textContent = `${(totalSpent / (dashboard.expenses.length + dashboard.subscriptions.length || 1)).toFixed(2)} avg txn`;

      const personalPercent = dashboard.budgets.personal ? Math.min((personalSpent / dashboard.budgets.personal) * 100, 200) : 0;
      const businessPercent = dashboard.budgets.business ? Math.min((businessSpent / dashboard.budgets.business) * 100, 200) : 0;
      document.getElementById('personal-percent').textContent = `${personalPercent.toFixed(1)}%`;
      document.getElementById('business-percent').textContent = `${businessPercent.toFixed(1)}%`;
      document.getElementById('personal-bar').style.width = `${personalPercent}%`;
      document.getElementById('business-bar').style.width = `${businessPercent}%`;
      document.getElementById('personal-left').textContent = formatCurrency(Math.max(dashboard.budgets.personal - personalSpent, 0));
      document.getElementById('business-left').textContent = formatCurrency(Math.max(dashboard.budgets.business - businessSpent, 0));
      document.getElementById('total-left').textContent = formatCurrency(Math.max((dashboard.budgets.personal + dashboard.budgets.business) - totalSpent, 0));
      document.getElementById('status-balance').textContent = totalSpent > (dashboard.budgets.personal + dashboard.budgets.business) ? 'Overbudget – adjust now' : 'Healthy cash runway';

      // Update budget page elements
      document.getElementById('budgets-personal-percent').textContent = `${personalPercent.toFixed(1)}%`;
      document.getElementById('budgets-business-percent').textContent = `${businessPercent.toFixed(1)}%`;
      document.getElementById('budgets-personal-bar').style.width = `${personalPercent}%`;
      document.getElementById('budgets-business-bar').style.width = `${businessPercent}%`;
      document.getElementById('budgets-personal-left').textContent = formatCurrency(Math.max(dashboard.budgets.personal - personalSpent, 0));
      document.getElementById('budgets-business-left').textContent = formatCurrency(Math.max(dashboard.budgets.business - businessSpent, 0));
      document.getElementById('budgets-status-balance').textContent = totalSpent > (dashboard.budgets.personal + dashboard.budgets.business) ? 'Overbudget – adjust now' : 'Healthy cash runway';
      document.getElementById('combined-budget').textContent = formatCurrency(dashboard.budgets.personal + dashboard.budgets.business);
    }

    function renderTables() {
      const dashboard = getCurrentDashboard();
      
      // Recent expenses table (overview)
      const recentExpenseBody = document.getElementById('recent-expense-table');
      const recentExpenseRows = [...dashboard.expenses]
        .sort((a, b) => new Date(b.date) - new Date(a.date))
        .slice(0, 5)
        .map(item => `
          <tr>
            <td class="py-3">
              <p class="font-semibold">${item.description}</p>
              <p class="text-xs text-slate-400">${new Date(item.date).toLocaleDateString()}</p>
            </td>
            <td class="py-3">
              <span class="px-2.5 py-1 rounded-full text-xs ${item.scope === 'personal' ? 'bg-rose-500/10 text-rose-200' : 'bg-sky-500/10 text-sky-200'}">${item.scope}</span>
            </td>
            <td class="py-3 text-slate-300">${item.category || '—'}</td>
            <td class="py-3 text-right font-semibold">${formatCurrency(Number(item.amount))}</td>
          </tr>
        `).join('');
      recentExpenseBody.innerHTML = recentExpenseRows || '<tr><td class="py-4 text-center text-slate-500" colspan="4">No expenses logged yet.</td></tr>';

      // Recent subscriptions table (overview)
      const recentSubBody = document.getElementById('recent-subscription-table');
      const recentSubRows = [...dashboard.subscriptions]
        .sort((a, b) => new Date(a.date) - new Date(b.date))
        .slice(0, 5)
        .map(item => `
          <tr>
            <td class="py-3">
              <p class="font-semibold">${item.name}</p>
              <p class="text-xs text-slate-400">Next · ${new Date(item.date).toLocaleDateString()}</p>
            </td>
            <td class="py-3">
              <span class="px-2.5 py-1 rounded-full text-xs ${item.scope === 'personal' ? 'bg-emerald-500/10 text-emerald-200' : 'bg-indigo-500/10 text-indigo-200'}">${item.scope}</span>
            </td>
            <td class="py-3 text-slate-300">${item.category}</td>
            <td class="py-3 text-slate-300">${item.billing}</td>
            <td class="py-3 text-right font-semibold">${formatCurrency(Number(item.amount))}</td>
          </tr>
        `).join('');
      recentSubBody.innerHTML = recentSubRows || '<tr><td class="py-4 text-center text-slate-500" colspan="5">No subscriptions on file.</td></tr>';

      // Full expense table (expenses page)
      const expenseBody = document.getElementById('expense-table');
      const expenseRows = [...dashboard.expenses]
        .sort((a, b) => new Date(b.date) - new Date(a.date))
        .map(item => `
          <tr>
            <td class="py-3">
              <p class="font-semibold">${item.description}</p>
              <p class="text-xs text-slate-400">${new Date(item.date).toLocaleDateString()}</p>
            </td>
            <td class="py-3">
              <span class="px-2.5 py-1 rounded-full text-xs ${item.scope === 'personal' ? 'bg-rose-500/10 text-rose-200' : 'bg-sky-500/10 text-sky-200'}">${item.scope}</span>
            </td>
            <td class="py-3 text-slate-300">${item.category || '—'}</td>
            <td class="py-3 text-right font-semibold">${formatCurrency(Number(item.amount))}</td>
            <td class="py-3 text-right">
              <button class="delete-btn text-rose-400 hover:text-rose-300 transition" data-id="${item.id}" data-type="expense">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
              </button>
            </td>
          </tr>
        `).join('');
      expenseBody.innerHTML = expenseRows || '<tr><td class="py-4 text-center text-slate-500" colspan="5">No expenses logged yet.</td></tr>';
      document.getElementById('expense-count').textContent = `${dashboard.expenses.length} entries`;
      document.getElementById('expenses-total').textContent = formatCurrency(dashboard.expenses.reduce((sum, e) => sum + Number(e.amount), 0));

      // Full subscription table (subscriptions page)
      const subBody = document.getElementById('subscription-table');
      const subRows = [...dashboard.subscriptions]
        .sort((a, b) => new Date(a.date) - new Date(b.date))
        .map(item => `
          <tr>
            <td class="py-3">
              <p class="font-semibold">${item.name}</p>
              <p class="text-xs text-slate-400">Next · ${new Date(item.date).toLocaleDateString()}</p>
            </td>
            <td class="py-3">
              <span class="px-2.5 py-1 rounded-full text-xs ${item.scope === 'personal' ? 'bg-emerald-500/10 text-emerald-200' : 'bg-indigo-500/10 text-indigo-200'}">${item.scope}</span>
            </td>
            <td class="py-3 text-slate-300">${item.category}</td>
            <td class="py-3 text-slate-300">${item.billing}</td>
            <td class="py-3 text-right font-semibold">${formatCurrency(Number(item.amount))}</td>
            <td class="py-3 text-right">
              <button class="delete-btn text-rose-400 hover:text-rose-300 transition" data-id="${item.id}" data-type="subscription">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
              </button>
            </td>
          </tr>
        `).join('');
      subBody.innerHTML = subRows || '<tr><td class="py-4 text-center text-slate-500" colspan="6">No subscriptions on file.</td></tr>';
      document.getElementById('subscription-page-count').textContent = `${dashboard.subscriptions.length} entries`;
      document.getElementById('subscriptions-total').textContent = formatCurrency(dashboard.subscriptions.reduce((sum, s) => sum + Number(s.amount), 0));
    }

    function renderDashboardList() {
      const dashboardList = document.getElementById('dashboard-list');
      const dashboardManagementList = document.getElementById('dashboard-management-list');
      const dashboardCount = document.getElementById('dashboard-count');
      
      dashboardList.innerHTML = '';
      dashboardManagementList.innerHTML = '';
      
      const dashboardIds = Object.keys(state.dashboards);
      dashboardCount.textContent = `${dashboardIds.length} dashboard${dashboardIds.length !== 1 ? 's' : ''}`;
      
      dashboardIds.forEach(dashboardId => {
        const dashboard = state.dashboards[dashboardId];
        const isActive = state.currentDashboardId === dashboardId;
        
        // Sidebar dashboard list
        const dashboardItem = document.createElement('div');
        dashboardItem.className = `dashboard-item flex items-center justify-between p-3 rounded-xl cursor-pointer ${isActive ? 'active' : ''}`;
        dashboardItem.innerHTML = `
          <div class="flex items-center gap-3">
            <div class="w-2 h-2 rounded-full ${isActive ? 'bg-blue-400' : 'bg-slate-600'}"></div>
            <span class="text-sm ${isActive ? 'text-white' : 'text-slate-400'}">${dashboard.name}</span>
          </div>
          <button class="delete-dashboard text-rose-400 hover:text-rose-300 text-xs" data-id="${dashboardId}">
            ×
          </button>
        `;
        dashboardItem.addEventListener('click', () => switchDashboard(dashboardId));
        dashboardList.appendChild(dashboardItem);
        
        // Dashboard management list
        const managementItem = document.createElement('div');
        managementItem.className = 'glass rounded-2xl p-4';
        managementItem.innerHTML = `
          <div class="flex items-center justify-between">
            <div>
              <h4 class="font-semibold">${dashboard.name}</h4>
              <p class="text-xs text-slate-400 mt-1">${dashboard.description || 'No description'}</p>
              <p class="text-xs text-slate-500 mt-1">Created: ${new Date(dashboard.createdAt).toLocaleDateString()}</p>
            </div>
            <div class="flex items-center gap-2">
              <button class="switch-dashboard px-3 py-1 bg-white/5 rounded-lg text-xs hover:bg-white/10 transition" data-id="${dashboardId}">
                ${isActive ? 'Active' : 'Switch'}
              </button>
              <button class="delete-dashboard px-3 py-1 bg-rose-500/10 rounded-lg text-xs text-rose-300 hover:bg-rose-500/20 transition" data-id="${dashboardId}">
                Delete
              </button>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4 mt-4 text-xs">
            <div class="text-center">
              <p class="text-slate-400">Expenses</p>
              <p class="font-semibold">${dashboard.expenses.length}</p>
            </div>
            <div class="text-center">
              <p class="text-slate-400">Subscriptions</p>
              <p class="font-semibold">${dashboard.subscriptions.length}</p>
            </div>
          </div>
        `;
        dashboardManagementList.appendChild(managementItem);
      });
    }

    function aggregateCategories(scope) {
      const dashboard = getCurrentDashboard();
      const bucket = {};
      dashboard.expenses.filter(e => e.scope === scope).forEach(e => {
        const key = e.category || 'Uncategorized';
        bucket[key] = (bucket[key] || 0) + Number(e.amount);
      });
      dashboard.subscriptions.filter(s => s.scope === scope).forEach(s => {
        const key = `${s.category || s.name}`;
        bucket[key] = (bucket[key] || 0) + Number(s.amount);
      });
      const entries = Object.entries(bucket);
      if (!entries.length) {
        return { labels: ['No data'], values: [1] };
      }
      return {
        labels: entries.map(([label]) => label),
        values: entries.map(([, value]) => value)
      };
    }

    function getExpenseTrendData() {
      const dashboard = getCurrentDashboard();
      // Get expenses from the last 30 days
      const thirtyDaysAgo = new Date();
      thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
      
      const recentExpenses = dashboard.expenses.filter(expense => 
        new Date(expense.date) >= thirtyDaysAgo
      );
      
      // Group by date
      const dailyTotals = {};
      recentExpenses.forEach(expense => {
        const date = expense.date.split('T')[0];
        if (!dailyTotals[date]) {
          dailyTotals[date] = 0;
        }
        dailyTotals[date] += Number(expense.amount);
      });
      
      // Fill in missing dates with 0
      const dates = [];
      for (let i = 29; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        dates.push(date.toISOString().split('T')[0]);
      }
      
      const labels = dates.map(date => {
        const d = new Date(date);
        return `${d.getMonth()+1}/${d.getDate()}`;
      });
      
      const data = dates.map(date => dailyTotals[date] || 0);
      
      return { labels, data };
    }

    function getSubscriptionData() {
      const dashboard = getCurrentDashboard();
      // Group subscriptions by billing cycle
      const billingData = {};
      dashboard.subscriptions.forEach(sub => {
        if (!billingData[sub.billing]) {
          billingData[sub.billing] = 0;
        }
        billingData[sub.billing] += Number(sub.amount);
      });
      
      return {
        labels: Object.keys(billingData),
        data: Object.values(billingData)
      };
    }

    function initCharts() {
      const dashboard = getCurrentDashboard();
      const combinedCtx = document.getElementById('combinedChart').getContext('2d');
      const personalCtx = document.getElementById('personalChart').getContext('2d');
      const businessCtx = document.getElementById('businessChart').getContext('2d');
      const budgetsCombinedCtx = document.getElementById('budgets-combinedChart').getContext('2d');

      combinedChart = new Chart(combinedCtx, {
        type: 'bar',
        data: {
          labels: ['Personal', 'Business'],
          datasets: [
            {
              label: 'Budget',
              data: [dashboard.budgets.personal, dashboard.budgets.business],
              backgroundColor: ['rgba(244, 114, 182, 0.3)', 'rgba(96, 165, 250, 0.3)'],
              borderColor: ['rgba(244, 114, 182, 1)', 'rgba(96, 165, 250, 1)'],
              borderWidth: 2
            },
            {
              label: 'Spent',
              data: [getScopeTotals('personal'), getScopeTotals('business')],
              backgroundColor: ['rgba(248, 250, 252, 0.9)', 'rgba(248, 250, 252, 0.9)'],
              borderRadius: 6
            },
            {
              label: 'Remaining',
              data: [Math.max(dashboard.budgets.personal - getScopeTotals('personal'), 0), Math.max(dashboard.budgets.business - getScopeTotals('business'), 0)],
              backgroundColor: ['rgba(16, 185, 129, 0.4)', 'rgba(34, 197, 94, 0.4)']
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: { color: '#cbd5f5' }
            }
          },
          scales: {
            x: {
              ticks: { color: '#94a3b8' },
              grid: { display: false }
            },
            y: {
              ticks: {
                color: '#94a3b8',
                callback: value => '$' + value
              },
              grid: { color: 'rgba(148, 163, 184, 0.2)' }
            }
          }
        }
      });

      budgetsCombinedChart = new Chart(budgetsCombinedCtx, {
        type: 'bar',
        data: {
          labels: ['Personal', 'Business'],
          datasets: [
            {
              label: 'Budget',
              data: [dashboard.budgets.personal, dashboard.budgets.business],
              backgroundColor: ['rgba(244, 114, 182, 0.3)', 'rgba(96, 165, 250, 0.3)'],
              borderColor: ['rgba(244, 114, 182, 1)', 'rgba(96, 165, 250, 1)'],
              borderWidth: 2
            },
            {
              label: 'Spent',
              data: [getScopeTotals('personal'), getScopeTotals('business')],
              backgroundColor: ['rgba(248, 250, 252, 0.9)', 'rgba(248, 250, 252, 0.9)'],
              borderRadius: 6
            },
            {
              label: 'Remaining',
              data: [Math.max(dashboard.budgets.personal - getScopeTotals('personal'), 0), Math.max(dashboard.budgets.business - getScopeTotals('business'), 0)],
              backgroundColor: ['rgba(16, 185, 129, 0.4)', 'rgba(34, 197, 94, 0.4)']
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: { color: '#cbd5f5' }
            }
          },
          scales: {
            x: {
              ticks: { color: '#94a3b8' },
              grid: { display: false }
            },
            y: {
              ticks: {
                color: '#94a3b8',
                callback: value => '$' + value
              },
              grid: { color: 'rgba(148, 163, 184, 0.2)' }
            }
          }
        }
      });

      const personalData = aggregateCategories('personal');
      personalChart = new Chart(personalCtx, {
        type: 'doughnut',
        data: {
          labels: personalData.labels,
          datasets: [{
            data: personalData.values,
            backgroundColor: personalData.labels.map((_, idx) => `hsla(${idx * 40}, 90%, 70%, 0.9)`),
            borderColor: '#0f172a'
          }]
        },
        options: {
          plugins: {
            legend: { labels: { color: '#cbd5f5', boxWidth: 12 } }
          }
        }
      });

      const businessData = aggregateCategories('business');
      businessChart = new Chart(businessCtx, {
        type: 'doughnut',
        data: {
          labels: businessData.labels,
          datasets: [{
            data: businessData.values,
            backgroundColor: businessData.labels.map((_, idx) => `hsla(${idx * 50 + 180}, 80%, 65%, 0.9)`),
            borderColor: '#0f172a'
          }]
        },
        options: {
          plugins: {
            legend: { labels: { color: '#cbd5f5', boxWidth: 12 } }
          }
        }
      });

      // Expenses Trend Chart
      const expensesTrendCtx = document.getElementById('expensesTrendChart').getContext('2d');
      const trendData = getExpenseTrendData();
      
      expensesTrendChart = new Chart(expensesTrendCtx, {
        type: 'line',
        data: {
          labels: trendData.labels,
          datasets: [{
            label: 'Daily Spending',
            data: trendData.data,
            borderColor: 'rgba(244, 114, 182, 1)',
            backgroundColor: 'rgba(244, 114, 182, 0.1)',
            borderWidth: 2,
            tension: 0.3,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: { color: '#cbd5f5' }
            }
          },
          scales: {
            x: {
              ticks: { color: '#94a3b8' },
              grid: { color: 'rgba(148, 163, 184, 0.1)' }
            },
            y: {
              ticks: {
                color: '#94a3b8',
                callback: value => '$' + value
              },
              grid: { color: 'rgba(148, 163, 184, 0.1)' }
            }
          }
        }
      });

      // Subscriptions Chart
      const subscriptionsCtx = document.getElementById('subscriptionsChart').getContext('2d');
      const subData = getSubscriptionData();
      
      subscriptionsChart = new Chart(subscriptionsCtx, {
        type: 'doughnut',
        data: {
          labels: subData.labels,
          datasets: [{
            data: subData.data,
            backgroundColor: [
              'rgba(96, 165, 250, 0.8)',
              'rgba(139, 92, 246, 0.8)',
              'rgba(16, 185, 129, 0.8)'
            ],
            borderColor: '#0f172a'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: { color: '#cbd5f5', boxWidth: 12 }
            }
          }
        }
      });
    }

    function updateCharts() {
      const dashboard = getCurrentDashboard();
      if (!combinedChart) return;
      combinedChart.data.datasets[0].data = [dashboard.budgets.personal, dashboard.budgets.business];
      combinedChart.data.datasets[1].data = [getScopeTotals('personal'), getScopeTotals('business')];
      combinedChart.data.datasets[2].data = [Math.max(dashboard.budgets.personal - getScopeTotals('personal'), 0), Math.max(dashboard.budgets.business - getScopeTotals('business'), 0)];
      combinedChart.update();

      if (budgetsCombinedChart) {
        budgetsCombinedChart.data.datasets[0].data = [dashboard.budgets.personal, dashboard.budgets.business];
        budgetsCombinedChart.data.datasets[1].data = [getScopeTotals('personal'), getScopeTotals('business')];
        budgetsCombinedChart.data.datasets[2].data = [Math.max(dashboard.budgets.personal - getScopeTotals('personal'), 0), Math.max(dashboard.budgets.business - getScopeTotals('business'), 0)];
        budgetsCombinedChart.update();
      }

      const personalData = aggregateCategories('personal');
      personalChart.data.labels = personalData.labels;
      personalChart.data.datasets[0].data = personalData.values;
      personalChart.data.datasets[0].backgroundColor = personalData.labels.map((_, idx) => `hsla(${idx * 40}, 90%, 70%, 0.9)`);
      personalChart.update();

      const businessData = aggregateCategories('business');
      businessChart.data.labels = businessData.labels;
      businessChart.data.datasets[0].data = businessData.values;
      businessChart.data.datasets[0].backgroundColor = businessData.labels.map((_, idx) => `hsla(${idx * 50 + 180}, 80%, 65%, 0.9)`);
      businessChart.update();

      // Update expenses trend chart
      if (expensesTrendChart) {
        const trendData = getExpenseTrendData();
        expensesTrendChart.data.labels = trendData.labels;
        expensesTrendChart.data.datasets[0].data = trendData.data;
        expensesTrendChart.update();
      }

      // Update subscriptions chart
      if (subscriptionsChart) {
        const subData = getSubscriptionData();
        subscriptionsChart.data.labels = subData.labels;
        subscriptionsChart.data.datasets[0].data = subData.data;
        subscriptionsChart.update();
      }

      document.getElementById('personal-mix-total').textContent = formatCurrency(getScopeTotals('personal'));
      document.getElementById('business-mix-total').textContent = formatCurrency(getScopeTotals('business'));
    }

    function setTodayDefaults() {
      const today = new Date().toISOString().split('T')[0];
      document.querySelectorAll('[data-today]').forEach(input => {
        if (!input.value) input.value = today;
      });
      document.getElementById('today-date').textContent = new Date().toLocaleDateString(undefined, { weekday: 'long', month: 'long', day: 'numeric' });
    }

    function render() {
      const dashboard = getCurrentDashboard();
      document.getElementById('current-dashboard-name').textContent = dashboard.name;
      renderHighlights();
      renderTables();
      renderDashboardList();
      updateCharts();
      document.querySelector('[name="personalBudget"]').value = dashboard.budgets.personal;
      document.querySelector('[name="businessBudget"]').value = dashboard.budgets.business;
      document.getElementById('budgets-budget-form').querySelector('[name="personalBudget"]').value = dashboard.budgets.personal;
      document.getElementById('budgets-budget-form').querySelector('[name="businessBudget"]').value = dashboard.budgets.business;
    }

    function downloadData() {
      const dashboard = getCurrentDashboard();
      
      // Create structured CSV data
      let csvData = 'LEDGER LUXE - FINANCIAL DATA EXPORT\n';
      csvData += '========================================\n\n';
      
      // Dashboard Information
      csvData += 'DASHBOARD INFORMATION\n';
      csvData += 'Name:,' + dashboard.name + '\n';
      csvData += 'Description:,' + (dashboard.description || 'N/A') + '\n';
      csvData += 'Created:,' + new Date(dashboard.createdAt).toLocaleDateString() + '\n\n';
      
      // Budgets
      csvData += 'BUDGETS\n';
      csvData += 'Scope,Amount\n';
      csvData += 'Personal Budget,' + formatCurrency(dashboard.budgets.personal) + '\n';
      csvData += 'Business Budget,' + formatCurrency(dashboard.budgets.business) + '\n';
      csvData += 'Total Budget,' + formatCurrency(dashboard.budgets.personal + dashboard.budgets.business) + '\n\n';
      
      // Expenses
      csvData += 'EXPENSES (' + dashboard.expenses.length + ' entries)\n';
      csvData += 'Date,Description,Scope,Category,Amount\n';
      dashboard.expenses.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(expense => {
        csvData += `${expense.date},${expense.description},${expense.scope},${expense.category},${formatCurrency(Number(expense.amount))}\n`;
      });
      
      // Summary of expenses by scope
      const personalExpenses = dashboard.expenses.filter(e => e.scope === 'personal');
      const businessExpenses = dashboard.expenses.filter(e => e.scope === 'business');
      csvData += '\nEXPENSE SUMMARY\n';
      csvData += 'Scope,Count,Total Amount\n';
      csvData += `Personal,${personalExpenses.length},${formatCurrency(personalExpenses.reduce((sum, e) => sum + Number(e.amount), 0))}\n`;
      csvData += `Business,${businessExpenses.length},${formatCurrency(businessExpenses.reduce((sum, e) => sum + Number(e.amount), 0))}\n`;
      csvData += `Total,${dashboard.expenses.length},${formatCurrency(dashboard.expenses.reduce((sum, e) => sum + Number(e.amount), 0))}\n\n`;
      
      // Subscriptions
      csvData += 'SUBSCRIPTIONS (' + dashboard.subscriptions.length + ' entries)\n';
      csvData += 'Name,Scope,Category,Billing Cycle,Next Charge,Amount\n';
      dashboard.subscriptions.sort((a, b) => new Date(a.date) - new Date(b.date)).forEach(sub => {
        csvData += `${sub.name},${sub.scope},${sub.category},${sub.billing},${sub.date},${formatCurrency(Number(sub.amount))}\n`;
      });
      
      // Summary of subscriptions by scope
      const personalSubs = dashboard.subscriptions.filter(s => s.scope === 'personal');
      const businessSubs = dashboard.subscriptions.filter(s => s.scope === 'business');
      csvData += '\nSUBSCRIPTION SUMMARY\n';
      csvData += 'Scope,Count,Total Monthly Amount\n';
      csvData += `Personal,${personalSubs.length},${formatCurrency(personalSubs.reduce((sum, s) => sum + Number(s.amount), 0))}\n`;
      csvData += `Business,${businessSubs.length},${formatCurrency(businessSubs.reduce((sum, s) => sum + Number(s.amount), 0))}\n`;
      csvData += `Total,${dashboard.subscriptions.length},${formatCurrency(dashboard.subscriptions.reduce((sum, s) => sum + Number(s.amount), 0))}\n\n`;
      
      // Overall Summary
      csvData += 'OVERALL SUMMARY\n';
      csvData += 'Category,Personal,Business,Total\n';
      csvData += `Expenses,${formatCurrency(personalExpenses.reduce((sum, e) => sum + Number(e.amount), 0))},${formatCurrency(businessExpenses.reduce((sum, e) => sum + Number(e.amount), 0))},${formatCurrency(dashboard.expenses.reduce((sum, e) => sum + Number(e.amount), 0))}\n`;
      csvData += `Subscriptions,${formatCurrency(personalSubs.reduce((sum, s) => sum + Number(s.amount), 0))},${formatCurrency(businessSubs.reduce((sum, s) => sum + Number(s.amount), 0))},${formatCurrency(dashboard.subscriptions.reduce((sum, s) => sum + Number(s.amount), 0))}\n`;
      csvData += `Total Spent,${formatCurrency(getScopeTotals('personal'))},${formatCurrency(getScopeTotals('business'))},${formatCurrency(getScopeTotals('personal') + getScopeTotals('business'))}\n`;
      csvData += `Budget,${formatCurrency(dashboard.budgets.personal)},${formatCurrency(dashboard.budgets.business)},${formatCurrency(dashboard.budgets.personal + dashboard.budgets.business)}\n`;
      csvData += `Remaining,${formatCurrency(Math.max(dashboard.budgets.personal - getScopeTotals('personal'), 0))},${formatCurrency(Math.max(dashboard.budgets.business - getScopeTotals('business'), 0))},${formatCurrency(Math.max((dashboard.budgets.personal + dashboard.budgets.business) - (getScopeTotals('personal') + getScopeTotals('business')), 0))}\n`;
      
      // Export date
      csvData += '\n\nExport Date:,' + new Date().toLocaleString();
      
      // Create a Blob with the CSV data
      const blob = new Blob([csvData], { type: 'text/csv' });
      
      // Create a URL for the Blob
      const url = URL.createObjectURL(blob);
      
      // Create a temporary anchor element to trigger the download
      const link = document.createElement('a');
      link.href = url;
      link.download = `ledger-luxe-${dashboard.name.replace(/\s+/g, '-').toLowerCase()}-${new Date().toISOString().split('T')[0]}.csv`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      // Clean up the URL
      URL.revokeObjectURL(url);
      
      // Show success message
      alert('Your dashboard data has been downloaded as a structured CSV file!');
    }

    function switchDashboard(dashboardId) {
      state.currentDashboardId = dashboardId;
      saveState();
      render();
      
      // Update category options for the new dashboard
      updateCategoryOptions('quick-expense-scope', 'quick-expense-category', 'expense');
      updateCategoryOptions('expense-scope', 'expense-category', 'expense');
      updateCategoryOptions('quick-subscription-scope', 'quick-subscription-category', 'subscription');
      updateCategoryOptions('subscription-scope', 'subscription-category', 'subscription');
    }

    function createDashboard(name, description, personalBudget = 0, businessBudget = 0) {
      const id = 'dashboard_' + Date.now();
      state.dashboards[id] = {
        id,
        name,
        description,
        createdAt: new Date().toISOString(),
        budgets: {
          personal: Number(personalBudget) || 0,
          business: Number(businessBudget) || 0
        },
        expenses: [],
        subscriptions: []
      };
      saveState();
      render();
      switchDashboard(id);
    }

    function deleteDashboard(dashboardId) {
      if (Object.keys(state.dashboards).length <= 1) {
        alert('You must have at least one dashboard.');
        return;
      }
      
      if (confirm(`Are you sure you want to delete the "${state.dashboards[dashboardId].name}" dashboard? This action cannot be undone.`)) {
        delete state.dashboards[dashboardId];
        
        // If we deleted the current dashboard, switch to the first available one
        if (state.currentDashboardId === dashboardId) {
          state.currentDashboardId = Object.keys(state.dashboards)[0];
        }
        
        saveState();
        render();
      }
    }

    function switchTab(tabName) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Show selected tab content
      document.getElementById(tabName).classList.add('active');
      
      // Update navigation buttons
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active', 'bg-white/5', 'text-white');
        btn.classList.add('text-slate-400');
      });
      
      // Activate current tab button
      document.querySelector(`.nav-btn[data-tab="${tabName}"]`).classList.add('active', 'bg-white/5', 'text-white');
      document.querySelector(`.nav-btn[data-tab="${tabName}"]`).classList.remove('text-slate-400');
    }

    // Event Listeners
    document.getElementById('budget-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const dashboard = getCurrentDashboard();
      const form = e.target;
      dashboard.budgets.personal = Number(form.personalBudget.value) || 0;
      dashboard.budgets.business = Number(form.businessBudget.value) || 0;
      saveState();
      render();
    });

    document.getElementById('budgets-budget-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const dashboard = getCurrentDashboard();
      const form = e.target;
      dashboard.budgets.personal = Number(form.personalBudget.value) || 0;
      dashboard.budgets.business = Number(form.businessBudget.value) || 0;
      saveState();
      render();
    });

    document.getElementById('expense-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const dashboard = getCurrentDashboard();
      const data = new FormData(e.target);
      const newExpense = {
        id: crypto.randomUUID(),
        description: data.get('description'),
        amount: Number(data.get('amount')),
        category: data.get('category'),
        scope: data.get('scope'),
        date: data.get('date') || new Date().toISOString()
      };
      dashboard.expenses.push(newExpense);
      saveState();
      render();
      e.target.reset();
      setTodayDefaults();
    });

    document.getElementById('subscription-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const dashboard = getCurrentDashboard();
      const data = new FormData(e.target);
      const newSub = {
        id: crypto.randomUUID(),
        name: data.get('name'),
        amount: Number(data.get('amount')),
        billing: data.get('billing'),
        category: data.get('category'),
        scope: data.get('scope'),
        date: data.get('date') || new Date().toISOString()
      };
      dashboard.subscriptions.push(newSub);
      saveState();
      render();
      e.target.reset();
      setTodayDefaults();
    });

    // Quick Add Forms
    document.getElementById('quick-expense-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const dashboard = getCurrentDashboard();
      const data = new FormData(e.target);
      const newExpense = {
        id: crypto.randomUUID(),
        description: data.get('description'),
        amount: Number(data.get('amount')),
        category: data.get('category'),
        scope: data.get('scope'),
        date: new Date().toISOString()
      };
      dashboard.expenses.push(newExpense);
      saveState();
      render();
      e.target.reset();
      
      // Show success feedback
      const btn = e.target.querySelector('button[type="submit"]');
      const originalText = btn.textContent;
      btn.textContent = 'Added!';
      btn.classList.remove('from-rose-400', 'to-amber-300');
      btn.classList.add('from-emerald-400', 'to-emerald-500');
      setTimeout(() => {
        btn.textContent = originalText;
        btn.classList.remove('from-emerald-400', 'to-emerald-500');
        btn.classList.add('from-rose-400', 'to-amber-300');
      }, 1500);
    });

    document.getElementById('quick-subscription-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const dashboard = getCurrentDashboard();
      const data = new FormData(e.target);
      const newSub = {
        id: crypto.randomUUID(),
        name: data.get('name'),
        amount: Number(data.get('amount')),
        billing: data.get('billing'),
        category: data.get('category'),
        scope: data.get('scope'),
        date: new Date().toISOString()
      };
      dashboard.subscriptions.push(newSub);
      saveState();
      render();
      e.target.reset();
      
      // Show success feedback
      const btn = e.target.querySelector('button[type="submit"]');
      const originalText = btn.textContent;
      btn.textContent = 'Added!';
      btn.classList.remove('from-sky-400', 'to-indigo-500');
      btn.classList.add('from-emerald-400', 'to-emerald-500');
      setTimeout(() => {
        btn.textContent = originalText;
        btn.classList.remove('from-emerald-400', 'to-emerald-500');
        btn.classList.add('from-sky-400', 'to-indigo-500');
      }, 1500);
    });

    // Create Dashboard Form
    document.getElementById('create-dashboard-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const data = new FormData(e.target);
      const name = data.get('name');
      const description = data.get('description');
      const personalBudget = data.get('personalBudget');
      const businessBudget = data.get('businessBudget');
      
      createDashboard(name, description, personalBudget, businessBudget);
      e.target.reset();
      
      // Switch to the new dashboard
      switchTab('overview');
    });

    // Add event listeners for scope changes to update category options
    document.getElementById('quick-expense-scope').addEventListener('change', () => {
      updateCategoryOptions('quick-expense-scope', 'quick-expense-category', 'expense');
    });

    document.getElementById('expense-scope').addEventListener('change', () => {
      updateCategoryOptions('expense-scope', 'expense-category', 'expense');
    });

    document.getElementById('quick-subscription-scope').addEventListener('change', () => {
      updateCategoryOptions('quick-subscription-scope', 'quick-subscription-category', 'subscription');
    });

    document.getElementById('subscription-scope').addEventListener('change', () => {
      updateCategoryOptions('subscription-scope', 'subscription-category', 'subscription');
    });

    document.addEventListener('click', (e) => {
      // Delete expense or subscription
      if (e.target.closest('.delete-btn')) {
        const btn = e.target.closest('.delete-btn');
        const id = btn.getAttribute('data-id');
        const type = btn.getAttribute('data-type');
        const dashboard = getCurrentDashboard();
        
        if (type === 'expense') {
          dashboard.expenses = dashboard.expenses.filter(item => item.id != id);
        } else if (type === 'subscription') {
          dashboard.subscriptions = dashboard.subscriptions.filter(item => item.id != id);
        }
        
        saveState();
        render();
      }
      
      // Delete dashboard
      if (e.target.closest('.delete-dashboard')) {
        const btn = e.target.closest('.delete-dashboard');
        const dashboardId = btn.getAttribute('data-id');
        deleteDashboard(dashboardId);
      }
      
      // Switch dashboard from management page
      if (e.target.closest('.switch-dashboard')) {
        const btn = e.target.closest('.switch-dashboard');
        const dashboardId = btn.getAttribute('data-id');
        switchDashboard(dashboardId);
        switchTab('overview');
      }
      
      // Tab navigation
      if (e.target.closest('.nav-btn')) {
        const btn = e.target.closest('.nav-btn');
        const tabName = btn.getAttribute('data-tab');
        switchTab(tabName);
      }
    });

    document.getElementById('reset-btn').addEventListener('click', () => {
      const dashboard = getCurrentDashboard();
      if (confirm('Are you sure you want to reset all data in the current dashboard? This will clear all expenses, subscriptions, and budgets.')) {
        dashboard.budgets.personal = 0;
        dashboard.budgets.business = 0;
        dashboard.expenses = [];
        dashboard.subscriptions = [];
        saveState();
        render();
      }
    });

    document.getElementById('download-btn').addEventListener('click', downloadData);

    document.getElementById('create-dashboard-btn').addEventListener('click', () => {
      switchTab('dashboards');
    });

    document.getElementById('create-dashboard-main').addEventListener('click', () => {
      document.getElementById('create-dashboard-form').scrollIntoView({ behavior: 'smooth' });
    });

    function init() {
      loadState();
      setTodayDefaults();
      initCharts();
      render();
      document.getElementById('last-updated').textContent = new Date().toLocaleTimeString();
      
      // Initialize category options for all forms
      updateCategoryOptions('quick-expense-scope', 'quick-expense-category', 'expense');
      updateCategoryOptions('expense-scope', 'expense-category', 'expense');
      updateCategoryOptions('quick-subscription-scope', 'quick-subscription-category', 'subscription');
      updateCategoryOptions('subscription-scope', 'subscription-category', 'subscription');
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
