<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Personal Finance Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Custom scrollbar for webkit browsers */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(148, 163, 184, 0.7); border-radius: 999px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(148, 163, 184, 1); }
  </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen">
  <div class="flex min-h-screen">
    <!-- Sidebar -->
    <aside id="sidebar" class="hidden md:flex md:flex-col w-64 bg-slate-950/80 border-r border-slate-800/80 backdrop-blur-xl fixed md:static inset-y-0 z-40">
      <div class="flex items-center gap-3 px-5 pt-4 pb-3 border-b border-slate-800/80">
        <div class="h-9 w-9 rounded-2xl bg-gradient-to-tr from-emerald-400 to-cyan-400 flex items-center justify-center shadow-lg shadow-emerald-500/30">
          <span class="text-xl font-black text-slate-950">ƒ</span>
        </div>
        <div>
          <div class="text-sm font-semibold tracking-wide text-slate-50">FlowTrack</div>
          <div class="text-[11px] uppercase tracking-[0.16em] text-emerald-300/80">Money Dashboard</div>
        </div>
      </div>
      <nav class="flex-1 overflow-y-auto px-3 py-4 space-y-1 text-sm">
        <button data-section="overview" class="nav-link flex items-center gap-2 w-full px-3 py-2 rounded-lg bg-slate-900/80 text-emerald-200 shadow-sm shadow-emerald-500/20">
          <span class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-emerald-500/10 text-emerald-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.7">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 4.5h16.5M3.75 9h16.5m-16.5 4.5h10.5M3.75 18h10.5" />
            </svg>
          </span>
          <span class="font-medium">Overview</span>
        </button>
        <button data-section="expenses" class="nav-link flex items-center gap-2 w-full px-3 py-2 rounded-lg text-slate-200/80 hover:bg-slate-900/70 transition">
          <span class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-sky-500/10 text-sky-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.7">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .843-3 1.875S10.343 11.75 12 11.75s3 .843 3 1.875S13.657 15.5 12 15.5m0-7.5V6m0 9.5v2M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </span>
          <span class="font-medium">Expenses</span>
        </button>
        <button data-section="subscriptions" class="nav-link flex items-center gap-2 w-full px-3 py-2 rounded-lg text-slate-200/80 hover:bg-slate-900/70 transition">
          <span class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-violet-500/10 text-violet-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.7">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 9.75l7.5-7.5 7.5 7.5M4.5 9.75V19.5A2.25 2.25 0 006.75 21.75h10.5A2.25 2.25 0 0019.5 19.5V9.75M8.25 21.75v-6a1.5 1.5 0 011.5-1.5h4.5a1.5 1.5 0 011.5 1.5v6" />
            </svg>
          </span>
          <span class="font-medium">Subscriptions</span>
        </button>
        <div class="pt-4 mt-4 border-t border-slate-800/80 text-xs uppercase tracking-[0.16em] text-slate-500">Tools</div>
        <button data-section="settings" class="nav-link flex items-center gap-2 w-full px-3 py-2 rounded-lg text-slate-200/80 hover:bg-slate-900/70 transition">
          <span class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-slate-700/50 text-slate-200">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.7">
              <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.607 2.296.102 2.572-1.065z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
          </span>
          <span class="font-medium">Settings</span>
        </button>
      </nav>
      <div class="border-t border-slate-800/80 px-4 py-3 text-[11px] text-slate-500 flex items-center justify-between">
        <span>Local data • Private</span>
        <button id="resetDataBtn" class="px-2 py-1 rounded-lg bg-slate-900/80 text-slate-300 hover:text-rose-300 hover:bg-rose-500/10 text-[11px] border border-slate-700/80 hover:border-rose-400/70 transition">
          Reset
        </button>
      </div>
    </aside>

    <!-- Mobile top bar -->
    <header class="md:hidden fixed top-0 inset-x-0 z-40 flex items-center justify-between bg-slate-950/95 backdrop-blur border-b border-slate-800/80 px-4 py-2.5">
      <button id="sidebarToggle" class="inline-flex items-center justify-center h-9 w-9 rounded-lg border border-slate-800/80 bg-slate-900/80 text-slate-200">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.7">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
      <div class="flex items-center gap-2">
        <div class="h-8 w-8 rounded-2xl bg-gradient-to-tr from-emerald-400 to-cyan-400 flex items-center justify-center shadow-lg shadow-emerald-500/30">
          <span class="text-lg font-black text-slate-950">ƒ</span>
        </div>
        <span class="text-sm font-semibold tracking-wide">FlowTrack</span>
      </div>
      <div class="h-8 w-8 rounded-full bg-slate-900/80 border border-slate-700/80 flex items-center justify-center text-[11px] text-slate-400">You</div>
    </header>

    <!-- Backdrop for mobile sidebar -->
    <div id="backdrop" class="md:hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-30 hidden"></div>

    <!-- Main content -->
    <main class="flex-1 flex flex-col md:ml-64">
      <!-- Desktop top bar -->
      <div class="hidden md:flex items-center justify-between px-7 pt-5 pb-3 border-b border-slate-800/80 bg-slate-950/80 backdrop-blur z-20">
        <div>
          <div class="flex items-center gap-2 text-xs uppercase tracking-[0.18em] text-slate-500">
            <span class="h-1.5 w-1.5 rounded-full bg-emerald-400 animate-pulse"></span>
            Live snapshot
          </div>
          <div class="mt-1 flex items-center gap-2 text-sm text-slate-200">
            <span id="welcomeTitle" class="font-semibold">Good day</span>
            <span class="h-1 w-1 rounded-full bg-slate-600"></span>
            <span id="todayLabel"></span>
          </div>
        </div>
        <div class="flex items-center gap-3">
          <label class="relative inline-flex items-center gap-2 text-xs text-slate-400 bg-slate-900/80 border border-slate-800/80 rounded-full px-2.5 py-1.5">
            <span class="hidden lg:inline">Monthly budget</span>
            <input id="budgetInput" type="number" min="0" step="10" class="w-24 bg-transparent border-none focus:outline-none text-right text-slate-100 text-xs" />
            <span class="text-slate-500 text-[11px]">USD</span>
          </label>
          <div class="hidden lg:flex items-center gap-2 text-xs text-slate-400 bg-slate-900/80 border border-slate-800/80 rounded-full px-3 py-1.5">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.7">
              <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5.75 5.75A2.25 2.25 0 018 3.5h8a2.25 2.25 0 012.25 2.25v11A2.25 2.25 0 0116 19H8a2.25 2.25 0 01-2.25-2.25v-11z" />
            </svg>
            <select id="timeRange" class="bg-transparent border-none text-xs focus:outline-none">
              <option value="month">This month</option>
              <option value="3months">Last 3 months</option>
              <option value="year">This year</option>
              <option value="all">All time</option>
            </select>
          </div>
          <button id="quickAddBtn" class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-emerald-500 text-slate-950 text-xs font-semibold shadow-lg shadow-emerald-500/40 hover:bg-emerald-400 transition">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.7">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
            </svg>
            New expense
          </button>
        </div>
      </div>

      <!-- Content wrapper -->
      <div class="pt-14 md:pt-4 pb-6 px-4 md:px-7 space-y-6 max-w-6xl mx-auto w-full">
        <!-- Overview section -->
        <section id="section-overview" class="space-y-6">
          <!-- Hero -->
          <div class="relative overflow-hidden rounded-2xl border border-slate-800/80 bg-gradient-to-br from-slate-900/90 via-slate-950 to-slate-950 px-5 sm:px-6 py-5 sm:py-6">
            <div class="absolute -right-32 -top-32 h-56 w-56 rounded-full bg-emerald-500/10 blur-3xl"></div>
            <div class="absolute -left-24 bottom-0 h-40 w-40 rounded-full bg-cyan-500/10 blur-3xl"></div>
            <div class="relative flex flex-col md:flex-row md:items-center gap-4 md:gap-6">
              <div class="flex-1 space-y-2">
                <div class="inline-flex items-center gap-2 rounded-full border border-emerald-500/40 bg-emerald-500/10 px-2.5 py-1 text-[11px] font-medium text-emerald-200">
                  <span class="inline-flex h-1.5 w-1.5 rounded-full bg-emerald-400 animate-ping"></span>
                  <span>Smart tracking · Local & private</span>
                </div>
                <h1 class="text-xl sm:text-2xl md:text-3xl font-semibold tracking-tight text-slate-50">
                  Stay on top of your <span class="text-emerald-300">expenses</span> & <span class="text-emerald-300">subscriptions</span>
                </h1>
                <p class="text-xs sm:text-sm text-slate-400 max-w-xl">
                  Capture daily spending, recurring payments, and upcoming renewals in one place. FlowTrack helps you see where your money goes every month.
                </p>
              </div>
              <div class="grid grid-cols-2 gap-3 w-full md:w-auto md:min-w-[260px] text-xs">
                <div class="rounded-xl border border-slate-800/80 bg-slate-950/80 px-3 py-2.5">
                  <div class="flex items-center justify-between">
                    <span class="text-[11px] text-slate-400">This month spent</span>
                    <span class="inline-flex h-5 px-1.5 items-center rounded-full bg-rose-500/10 text-[10px] font-medium text-rose-300">
                      <span id="monthChangeLabel">+0%</span>
                    </span>
                  </div>
                  <div class="mt-1 text-sm font-semibold text-slate-50" id="heroMonthSpent">$0</div>
                </div>
                <div class="rounded-xl border border-slate-800/80 bg-slate-950/80 px-3 py-2.5">
                  <div class="flex items-center justify-between">
                    <span class="text-[11px] text-slate-400">Active subs</span>
                    <span class="inline-flex h-5 w-5 items-center justify-center rounded-full bg-violet-500/15 text-[10px] text-violet-200">
                      ♺
                    </span>
                  </div>
                  <div class="mt-1 flex items-baseline gap-1">
                    <span class="text-sm font-semibold text-slate-50" id="heroSubCount">0</span>
                    <span class="text-[11px] text-slate-400">· $<span id="heroSubTotal">0</span>/mo</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- KPI cards -->
          <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4">
            <div class="relative overflow-hidden rounded-2xl border border-emerald-500/40 bg-gradient-to-br from-emerald-500/15 via-emerald-500/5 to-slate-950 px-4 py-3.5">
              <div class="absolute -right-10 -top-10 h-24 w-24 rounded-full bg-emerald-400/20 blur-2xl"></div>
              <div class="relative flex items-start justify-between gap-2">
                <div>
                  <div class="text-[11px] font-medium uppercase tracking-[0.16em] text-emerald-200/90">Total spent</div>
                  <div class="mt-1 text-lg font-semibold text-slate-50" id="metric-total-spent">$0</div>
                  <div class="mt-0.5 text-[11px] text-emerald-200/80">Across selected range</div>
                </div>
                <div class="inline-flex h-8 w-8 items-center justify-center rounded-xl bg-emerald-500/15 text-emerald-200">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.7">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 4.5l-8.25 8.25L7.5 17.25V19.5h2.25l3 3 8.25-8.25-9.75-9.75z" />
                  </svg>
                </div>
              </div>
            </div>
            <div class="relative overflow-hidden rounded-2xl border border-sky-500/40 bg-gradient-to-br from-sky-500/15 via-sky-500/5 to-slate-950 px-4 py-3.5">
              <div class="absolute -right-10 -top-10 h-24 w-24 rounded-full bg-sky-400/20 blur-2xl"></div>
              <div class="relative flex items-start justify-between gap-2">
                <div>
                  <div class="text-[11px] font-medium uppercase tracking-[0.16em] text-sky-200/90">Average per day</div>
                  <div class="mt-1 text-lg font-semibold text-slate-50" id="metric-avg-day">$0</div>
                  <div class="mt-0.5 text-[11px] text-sky-200/80">For current month</div>
                </div>
                <div class="inline-flex h-8 w-8 items-center justify-center rounded-xl bg-sky-500/15 text-sky-200">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.7">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0A9 9 0 1112 3a9 9 0 019 9z" />
                  </svg>
                </div>
              </div>
            </div>
            <div class="relative overflow-hidden rounded-2xl border border-violet-500/40 bg-gradient-to-br from-violet-500/15 via-violet-500/5 to-slate-950 px-4 py-3.5">
              <div class="absolute -right-10 -top-10 h-24 w-24 rounded-full bg-violet-400/20 blur-2xl"></div>
              <div class="relative flex items-start justify-between gap-2">
                <div>
                  <div class="text-[11px] font-medium uppercase tracking-[0.16em] text-violet-200/90">Upcoming bills</div>
                  <div class="mt-1 flex items-baseline gap-1">
                    <span class="text-lg font-semibold text-slate-50" id="metric-upcoming-count">0</span>
                    <span class="text-[11px] text-slate-400">within 30 days</span>
                  </div>
                  <div class="mt-0.5 text-[11px] text-violet-200/80">Total $<span id="metric-upcoming-total">0</span></div>
                </div>
                <div class="inline-flex h-8 w-8 items-center justify-center rounded-xl bg-violet-500/15 text-violet-200">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.7">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
              </div>
            </div>
            <div class="relative overflow-hidden rounded-2xl border border-amber-500/40 bg-gradient-to-br from-amber-500/15 via-amber-500/5 to-slate-950 px-4 py-3.5 flex items-center gap-3">
              <div class="relative flex-1">
                <div class="text-[11px] font-medium uppercase tracking-[0.16em] text-amber-200/90">Budget usage</div>
                <div class="mt-1 flex items-baseline gap-1">
                  <span class="text-lg font-semibold text-slate-50" id="metric-budget-used">0%</span>
                  <span class="text-[11px] text-slate-400">of $<span id="metric-budget-total">0</span></span>
                </div>
                <div class="mt-1 h-1.5 w-full rounded-full bg-slate-900/80 overflow-hidden">
                  <div id="metric-budget-bar" class="h-full rounded-full bg-gradient-to-r from-emerald-400 via-amber-300 to-rose-400" style="width:0%"></div>
                </div>
              </div>
              <div class="relative h-14 w-14 rounded-full bg-slate-950/80 flex items-center justify-center border border-amber-500/50">
                <svg class="h-10 w-10 -rotate-90">
                  <circle cx="20" cy="20" r="16" class="stroke-slate-800" stroke-width="5" fill="transparent" />
                  <circle id="budgetRing" cx="20" cy="20" r="16" class="stroke-amber-400" stroke-width="5" fill="transparent" stroke-linecap="round" stroke-dasharray="100" stroke-dashoffset="100" />
                </svg>
                <span class="absolute text-[11px] font-semibold" id="budgetRingLabel">0%</span>
              </div>
            </div>
          </div>

          <!-- Charts & recent activity -->
          <div class="grid grid-cols-1 xl:grid-cols-3 gap-4">
            <div class="xl:col-span-2 space-y-4">
              <div class="rounded-2xl border border-slate-800/80 bg-slate-950/80 px-4 py-3.5">
                <div class="flex items-center justify-between gap-2 mb-2.5">
                  <div>
                    <div class="text-xs font-medium text-slate-200">Spending trend</div>
                    <div class="text-[11px] text-slate-500">Last 6 months of expenses</div>
                  </div>
                  <div class="flex items-center gap-2 text-[11px] text-slate-400">
                    <span class="inline-flex items-center gap-1"><span class="h-2 w-2 rounded-full bg-emerald-400"></span>Expenses</span>
                    <span class="inline-flex items-center gap-1"><span class="h-2 w-2 rounded-full bg-sky-400"></span>Subscriptions (mo)</span>
                  </div>
                </div>
                <div class="h-52">
                  <canvas id="spendingChart"></canvas>
                </div>
              </div>
            </div>
            <div class="space-y-4">
              <div class="rounded-2xl border border-slate-800/80 bg-slate-950/80 px-4 py-3.5">
                <div class="flex items-center justify-between mb-2.5">
                  <div>
                    <div class="text-xs font-medium text-slate-200">By category</div>
                    <div class="text-[11px] text-slate-500">Current month distribution</div>
                  </div>
                </div>
                <div class="h-40">
                  <canvas id="categoryChart"></canvas>
                </div>
              </div>
              <div class="rounded-2xl border border-slate-800/80 bg-slate-950/80 px-4 py-3.5">
                <div class="flex items-center justify-between mb-2.5">
                  <div>
                    <div class="text-xs font-medium text-slate-200">Today snapshot</div>
                    <div class="text-[11px] text-slate-500">Quick look at today</div>
                  </div>
                  <button id="addTodayExpenseBtn" class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg bg-slate-900 text-[11px] border border-slate-700/80 hover:border-emerald-400/80 hover:text-emerald-200 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.7">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                    </svg>
                    Log today
                  </button>
                </div>
                <div class="space-y-2 text-[11px] text-slate-300">
                  <div class="flex items-center justify-between">
                    <span class="text-slate-400">Today spent</span>
                    <span id="todaySpentLabel">$0</span>
                  </div>
                  <div class="flex items-center justify-between">
                    <span class="text-slate-400">Transactions</span>
                    <span id="todayCountLabel">0</span>
                  </div>
                  <div class="flex items-center justify-between">
                    <span class="text-slate-400">Largest expense</span>
                    <span id="todayLargestLabel">$0</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent expenses & subscriptions -->
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
            <div class="lg:col-span-2 rounded-2xl border border-slate-800/80 bg-slate-950/80 overflow-hidden">
              <div class="flex items-center justify-between px-4 py-3 border-b border-slate-800/80">
                <div>
                  <div class="text-xs font-medium text-slate-200">Recent expenses</div>
                  <div class="text-[11px] text-slate-500">Latest 10 entries</div>
                </div>
                <button id="openExpenseModalBtn" class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg bg-slate-900 text-[11px] border border-slate-700/80 hover:border-emerald-400/80 hover:text-emerald-200 transition">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.7">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                  </svg>
                  Add expense
                </button>
              </div>
              <div class="overflow-x-auto">
                <table class="min-w-full text-[11px]">
                  <thead class="bg-slate-950/90 border-b border-slate-800/80 text-slate-400">
                    <tr>
                      <th class="text-left font-medium px-4 py-2.5">Date</th>
                      <th class="text-left font-medium px-2 py-2.5">Description</th>
                      <th class="text-left font-medium px-2 py-2.5">Category</th>
                      <th class="text-right font-medium px-2 py-2.5">Amount</th>
                      <th class="text-left font-medium px-2 py-2.5">Method</th>
                    </tr>
                  </thead>
                  <tbody id="recentExpensesBody" class="divide-y divide-slate-800/80"></tbody>
                </table>
              </div>
            </div>
            <div class="rounded-2xl border border-slate-800/80 bg-slate-950/80 overflow-hidden">
              <div class="flex items-center justify-between px-4 py-3 border-b border-slate-800/80">
                <div>
                  <div class="text-xs font-medium text-slate-200">Active subscriptions</div>
                  <div class="text-[11px] text-slate-500">Top recurring costs</div>
                </div>
                <button id="openSubscriptionModalBtn" class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg bg-slate-900 text-[11px] border border-slate-700/80 hover:border-violet-400/80 hover:text-violet-200 transition">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.7">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                  </svg>
                  Add sub
                </button>
              </div>
              <div class="max-h-64 overflow-y-auto text-[11px]">
                <table class="min-w-full">
                  <thead class="bg-slate-950/90 border-b border-slate-800/80 text-slate-400">
                    <tr>
                      <th class="text-left font-medium px-4 py-2.5">Name</th>
                      <th class="text-right font-medium px-2 py-2.5">Amount</th>
                      <th class="text-left font-medium px-2 py-2.5">Cycle</th>
                    </tr>
                  </thead>
                  <tbody id="overviewSubsBody" class="divide-y divide-slate-800/80"></tbody>
                </table>
              </div>
            </div>
          </div>
        </section>

        <!-- Expenses page -->
        <section id="section-expenses" class="space-y-4 hidden">
          <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
            <div>
              <div class="text-xs uppercase tracking-[0.16em] text-slate-500">Expenses</div>
              <h2 class="text-lg font-semibold text-slate-50">All expenses</h2>
            </div>
            <div class="flex flex-wrap items-center gap-2 text-[11px]">
              <select id="expensesCategoryFilter" class="bg-slate-950 border border-slate-800/80 rounded-lg px-2.5 py-1.5 text-slate-200">
                <option value="all">All categories</option>
              </select>
              <select id="expensesTimeFilter" class="bg-slate-950 border border-slate-800/80 rounded-lg px-2.5 py-1.5 text-slate-200">
                <option value="month">This month</option>
                <option value="3months">Last 3 months</option>
                <option value="year">This year</option>
                <option value="all">All time</option>
              </select>
              <button id="addExpenseFromExpenses" class="inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg bg-emerald-500 text-slate-950 font-medium hover:bg-emerald-400 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.7">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                </svg>
                Add expense
              </button>
            </div>
          </div>
          <div class="rounded-2xl border border-slate-800/80 bg-slate-950/80 overflow-hidden">
            <div class="overflow-x-auto max-h-[420px]">
              <table class="min-w-full text-[11px]">
                <thead class="bg-slate-950/90 border-b border-slate-800/80 text-slate-400 sticky top-0 z-10">
                  <tr>
                    <th class="text-left font-medium px-4 py-2.5">Date</th>
                    <th class="text-left font-medium px-2 py-2.5">Description</th>
                    <th class="text-left font-medium px-2 py-2.5">Category</th>
                    <th class="text-right font-medium px-2 py-2.5">Amount</th>
                    <th class="text-left font-medium px-2 py-2.5">Payment</th>
                    <th class="text-left font-medium px-2 py-2.5">Notes</th>
                  </tr>
                </thead>
                <tbody id="expensesTableBody" class="divide-y divide-slate-800/80"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Subscriptions page -->
        <section id="section-subscriptions" class="space-y-4 hidden">
          <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
            <div>
              <div class="text-xs uppercase tracking-[0.16em] text-slate-500">Subscriptions</div>
              <h2 class="text-lg font-semibold text-slate-50">Recurring payments</h2>
            </div>
            <div class="flex flex-wrap items-center gap-2 text-[11px]">
              <select id="subsStatusFilter" class="bg-slate-950 border border-slate-800/80 rounded-lg px-2.5 py-1.5 text-slate-200">
                <option value="active">Active</option>
                <option value="all">All</option>
                <option value="paused">Paused</option>
                <option value="cancelled">Cancelled</option>
              </select>
              <button id="addSubFromSubs" class="inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg bg-violet-500 text-slate-950 font-medium hover:bg-violet-400 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.7">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                </svg>
                Add subscription
              </button>
            </div>
          </div>
          <div class="rounded-2xl border border-slate-800/80 bg-slate-950/80 overflow-hidden">
            <div class="overflow-x-auto max-h-[420px]">
              <table class="min-w-full text-[11px]">
                <thead class="bg-slate-950/90 border-b border-slate-800/80 text-slate-400 sticky top-0 z-10">
                  <tr>
                    <th class="text-left font-medium px-4 py-2.5">Name</th>
                    <th class="text-left font-medium px-2 py-2.5">Category</th>
                    <th class="text-right font-medium px-2 py-2.5">Amount</th>
                    <th class="text-left font-medium px-2 py-2.5">Billing</th>
                    <th class="text-left font-medium px-2 py-2.5">Next charge</th>
                    <th class="text-left font-medium px-2 py-2.5">Status</th>
                  </tr>
                </thead>
                <tbody id="subsTableBody" class="divide-y divide-slate-800/80"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Settings page -->
        <section id="section-settings" class="space-y-4 hidden">
          <div>
            <div class="text-xs uppercase tracking-[0.16em] text-slate-500">Settings</div>
            <h2 class="text-lg font-semibold text-slate-50">Preferences</h2>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="rounded-2xl border border-slate-800/80 bg-slate-950/80 px-4 py-3.5 space-y-3 text-sm">
              <div class="flex items-center justify-between">
                <div>
                  <div class="font-medium text-slate-100">Currency</div>
                  <div class="text-[11px] text-slate-500">Display currency symbol only (USD)</div>
                </div>
                <div class="px-2 py-1 rounded-lg bg-slate-900 border border-slate-800 text-[11px] text-slate-300">$</div>
              </div>
              <p class="text-[11px] text-slate-500">Multi-currency support can be added later. For now the dashboard assumes USD or your equivalent.</p>
            </div>
            <div class="rounded-2xl border border-slate-800/80 bg-slate-950/80 px-4 py-3.5 space-y-3 text-sm">
              <div class="flex items-center justify-between">
                <div>
                  <div class="font-medium text-slate-100">Local storage</div>
                  <div class="text-[11px] text-slate-500">Your data never leaves this browser</div>
                </div>
                <button id="settingsResetBtn" class="inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg bg-slate-900 text-[11px] border border-slate-700/80 hover:border-rose-400/80 hover:text-rose-200 transition">
                  Clear data
                </button>
              </div>
              <p class="text-[11px] text-slate-500">Use this if you want to wipe all expenses and subscriptions from this dashboard.</p>
            </div>
          </div>
        </section>
      </div>
    </main>

    <!-- Expense modal -->
    <div id="expenseModal" class="fixed inset-0 z-50 hidden items-center justify-center">
      <div class="absolute inset-0 bg-black/70 backdrop-blur-sm"></div>
      <div class="relative w-full max-w-md mx-3 rounded-2xl border border-slate-800/90 bg-slate-950/95 shadow-2xl shadow-emerald-500/20">
        <div class="flex items-center justify-between px-4 py-3 border-b border-slate-800/80">
          <div>
            <div class="text-sm font-semibold text-slate-50">Add expense</div>
            <div class="text-[11px] text-slate-500">Log a one-time transaction</div>
          </div>
          <button data-close-modal="expenseModal" class="h-7 w-7 inline-flex items-center justify-center rounded-lg bg-slate-900/80 text-slate-400 hover:text-slate-100">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.7">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        <form id="expenseForm" class="px-4 py-3 space-y-3 text-[13px]">
          <div class="flex gap-2">
            <label class="flex-1 text-xs text-slate-300 space-y-1">
              <span>Description</span>
              <input required id="expenseDescription" type="text" placeholder="Groceries, Uber, etc." class="w-full rounded-lg border border-slate-700/80 bg-slate-950/80 px-2.5 py-1.5 text-[13px] text-slate-100 focus:outline-none focus:border-emerald-400/80" />
            </label>
            <label class="w-28 text-xs text-slate-300 space-y-1">
              <span>Amount</span>
              <input required id="expenseAmount" type="number" min="0" step="0.01" class="w-full rounded-lg border border-slate-700/80 bg-slate-950/80 px-2.5 py-1.5 text-[13px] text-slate-100 focus:outline-none focus:border-emerald-400/80" />
            </label>
          </div>
          <div class="flex gap-2">
            <label class="w-32 text-xs text-slate-300 space-y-1">
              <span>Date</span>
              <input required id="expenseDate" type="date" class="w-full rounded-lg border border-slate-700/80 bg-slate-950/80 px-2.5 py-1.5 text-[13px] text-slate-100 focus:outline-none focus:border-emerald-400/80" />
            </label>
            <label class="flex-1 text-xs text-slate-300 space-y-1">
              <span>Category</span>
              <select id="expenseCategory" class="w-full rounded-lg border border-slate-700/80 bg-slate-950/80 px-2.5 py-1.5 text-[13px] text-slate-100 focus:outline-none focus:border-emerald-400/80">
                <option>General</option>
                <option>Food</option>
                <option>Transport</option>
                <option>Housing</option>
                <option>Shopping</option>
                <option>Entertainment</option>
                <option>Health</option>
                <option>Travel</option>
              </select>
            </label>
          </div>
          <div class="flex gap-2">
            <label class="w-32 text-xs text-slate-300 space-y-1">
              <span>Method</span>
              <select id="expenseMethod" class="w-full rounded-lg border border-slate-700/80 bg-slate-950/80 px-2.5 py-1.5 text-[13px] text-slate-100 focus:outline-none focus:border-emerald-400/80">
                <option>Card</option>
                <option>Cash</option>
                <option>Bank transfer</option>
                <option>Wallet</option>
              </select>
            </label>
            <label class="flex-1 text-xs text-slate-300 space-y-1">
              <span>Notes (optional)</span>
              <input id="expenseNotes" type="text" placeholder="Tags, extra details" class="w-full rounded-lg border border-slate-700/80 bg-slate-950/80 px-2.5 py-1.5 text-[13px] text-slate-100 focus:outline-none focus:border-emerald-400/80" />
            </label>
          </div>
          <div class="flex items-center justify-between pt-2 border-t border-slate-800/80 mt-2">
            <span class="text-[11px] text-slate-500">You can edit or remove this later by clearing data.</span>
            <button type="submit" class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-emerald-500 text-slate-950 text-xs font-semibold hover:bg-emerald-400 transition">
              Save expense
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Subscription modal -->
    <div id="subscriptionModal" class="fixed inset-0 z-50 hidden items-center justify-center">
      <div class="absolute inset-0 bg-black/70 backdrop-blur-sm"></div>
      <div class="relative w-full max-w-md mx-3 rounded-2xl border border-slate-800/90 bg-slate-950/95 shadow-2xl shadow-violet-500/20">
        <div class="flex items-center justify-between px-4 py-3 border-b border-slate-800/80">
          <div>
            <div class="text-sm font-semibold text-slate-50">Add subscription</div>
            <div class="text-[11px] text-slate-500">Track recurring payments</div>
          </div>
          <button data-close-modal="subscriptionModal" class="h-7 w-7 inline-flex items-center justify-center rounded-lg bg-slate-900/80 text-slate-400 hover:text-slate-100">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.7">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        <form id="subscriptionForm" class="px-4 py-3 space-y-3 text-[13px]">
          <div class="flex gap-2">
            <label class="flex-1 text-xs text-slate-300 space-y-1">
              <span>Name</span>
              <input required id="subName" type="text" placeholder="Netflix, Spotify, Rent" class="w-full rounded-lg border border-slate-700/80 bg-slate-950/80 px-2.5 py-1.5 text-[13px] text-slate-100 focus:outline-none focus:border-violet-400/80" />
            </label>
            <label class="w-28 text-xs text-slate-300 space-y-1">
              <span>Amount</span>
              <input required id="subAmount" type="number" min="0" step="0.01" class="w-full rounded-lg border border-slate-700/80 bg-slate-950/80 px-2.5 py-1.5 text-[13px] text-slate-100 focus:outline-none focus:border-violet-400/80" />
            </label>
          </div>
          <div class="flex gap-2">
            <label class="flex-1 text-xs text-slate-300 space-y-1">
              <span>Category</span>
              <select id="subCategory" class="w-full rounded-lg border border-slate-700/80 bg-slate-950/80 px-2.5 py-1.5 text-[13px] text-slate-100 focus:outline-none focus:border-violet-400/80">
                <option>Streaming</option>
                <option>Productivity</option>
                <option>Music</option>
                <option>Cloud</option>
                <option>Utilities</option>
                <option>Rent</option>
                <option>Other</option>
              </select>
            </label>
            <label class="w-32 text-xs text-slate-300 space-y-1">
              <span>Billing cycle</span>
              <select id="subBilling" class="w-full rounded-lg border border-slate-700/80 bg-slate-950/80 px-2.5 py-1.5 text-[13px] text-slate-100 focus:outline-none focus:border-violet-400/80">
                <option value="monthly">Monthly</option>
                <option value="yearly">Yearly</option>
                <option value="weekly">Weekly</option>
              </select>
            </label>
          </div>
          <div class="flex gap-2">
            <label class="w-32 text-xs text-slate-300 space-y-1">
              <span>Next charge</span>
              <input required id="subNext" type="date" class="w-full rounded-lg border border-slate-700/80 bg-slate-950/80 px-2.5 py-1.5 text-[13px] text-slate-100 focus:outline-none focus:border-violet-400/80" />
            </label>
            <label class="flex-1 text-xs text-slate-300 space-y-1">
              <span>Status</span>
              <select id="subStatus" class="w-full rounded-lg border border-slate-700/80 bg-slate-950/80 px-2.5 py-1.5 text-[13px] text-slate-100 focus:outline-none focus:border-violet-400/80">
                <option value="active">Active</option>
                <option value="paused">Paused</option>
                <option value="cancelled">Cancelled</option>
              </select>
            </label>
          </div>
          <div class="flex items-center justify-between pt-2 border-t border-slate-800/80 mt-2">
            <span class="text-[11px] text-slate-500">We estimate monthly cost from the billing cycle.</span>
            <button type="submit" class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-violet-500 text-slate-950 text-xs font-semibold hover:bg-violet-400 transition">
              Save subscription
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Basic utilities
    const formatCurrency = (value) => {
      if (!isFinite(value)) return '$0';
      return '$' + value.toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 2 });
    };

    const todayISO = () => new Date().toISOString().slice(0, 10);

    const STORAGE_KEY = 'flowtrack-data-v1';

    function loadData() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return seedDemoData();
      try {
        const parsed = JSON.parse(raw);
        if (!parsed.expenses || !parsed.subscriptions || typeof parsed.budget !== 'number') throw new Error('Invalid');
        return parsed;
      } catch (e) {
        return seedDemoData();
      }
    }

    function saveData(data) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function seedDemoData() {
      const now = new Date();
      const month = now.getMonth();
      const year = now.getFullYear();
      const demoExpenses = [
        { date: new Date(year, month, 1).toISOString().slice(0,10), description: 'Groceries', category: 'Food', amount: 72.43, method: 'Card', notes: 'Supermarket' },
        { date: new Date(year, month, 2).toISOString().slice(0,10), description: 'Uber ride', category: 'Transport', amount: 18.2, method: 'Wallet', notes: '' },
        { date: new Date(year, month, 3).toISOString().slice(0,10), description: 'Coffee & snacks', category: 'Food', amount: 9.8, method: 'Card', notes: '' },
        { date: new Date(year, month, 4).toISOString().slice(0,10), description: 'Gym day pass', category: 'Health', amount: 15, method: 'Card', notes: '' },
        { date: new Date(year, month, 8).toISOString().slice(0,10), description: 'New headphones', category: 'Shopping', amount: 120, method: 'Card', notes: 'Sale' },
        { date: new Date(year, month - 1, 18).toISOString().slice(0,10), description: 'Weekend trip', category: 'Travel', amount: 260, method: 'Card', notes: '' },
        { date: new Date(year, month - 2, 10).toISOString().slice(0,10), description: 'Groceries', category: 'Food', amount: 64.1, method: 'Card', notes: '' },
      ];

      const demoSubs = [
        { name: 'Netflix', category: 'Streaming', amount: 15.99, billing: 'monthly', next: new Date(year, month, 28).toISOString().slice(0,10), status: 'active' },
        { name: 'Spotify', category: 'Music', amount: 9.99, billing: 'monthly', next: new Date(year, month, 20).toISOString().slice(0,10), status: 'active' },
        { name: 'iCloud', category: 'Cloud', amount: 2.99, billing: 'monthly', next: new Date(year, month, 15).toISOString().slice(0,10), status: 'active' },
        { name: 'Notion', category: 'Productivity', amount: 96, billing: 'yearly', next: new Date(year, month + 5, 1).toISOString().slice(0,10), status: 'active' },
        { name: 'Gym membership', category: 'Health', amount: 35, billing: 'monthly', next: new Date(year, month, 7).toISOString().slice(0,10), status: 'paused' },
      ];

      const demo = { expenses: demoExpenses, subscriptions: demoSubs, budget: 2000 };
      saveData(demo);
      return demo;
    }

    let state = loadData();

    // Navigation
    function initNavigation() {
      const links = document.querySelectorAll('.nav-link');
      const sections = {
        overview: document.getElementById('section-overview'),
        expenses: document.getElementById('section-expenses'),
        subscriptions: document.getElementById('section-subscriptions'),
        settings: document.getElementById('section-settings'),
      };

      links.forEach((btn) => {
        btn.addEventListener('click', () => {
          const target = btn.dataset.section;
          if (!target) return;
          links.forEach((b) => b.classList.remove('bg-slate-900/80', 'text-emerald-200', 'shadow-sm', 'shadow-emerald-500/20'));
          links[0].classList.remove('bg-slate-900/80', 'text-emerald-200', 'shadow-sm', 'shadow-emerald-500/20');
          btn.classList.add('bg-slate-900/80', 'text-emerald-200', 'shadow-sm', 'shadow-emerald-500/20');

          Object.values(sections).forEach((sec) => sec.classList.add('hidden'));
          sections[target].classList.remove('hidden');
        });
      });
    }

    // Sidebar mobile
    function initSidebar() {
      const sidebar = document.getElementById('sidebar');
      const toggle = document.getElementById('sidebarToggle');
      const backdrop = document.getElementById('backdrop');

      function open() {
        sidebar.classList.remove('hidden');
        backdrop.classList.remove('hidden');
      }
      function close() {
        sidebar.classList.add('hidden');
        backdrop.classList.add('hidden');
      }

      toggle.addEventListener('click', open);
      backdrop.addEventListener('click', close);
    }

    // Charts
    let spendingChart, categoryChart;

    function getMonthLabel(date) {
      return date.toLocaleString(undefined, { month: 'short' });
    }

    function monthKey(date) { return date.getFullYear() + '-' + (date.getMonth() + 1); }

    function getMonthlyData() {
      const now = new Date();
      const months = [];
      for (let i = 5; i >= 0; i--) {
        const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
        months.push({ key: monthKey(d), label: getMonthLabel(d) });
      }

      const expensesMap = new Map();
      const subsMap = new Map();
      months.forEach((m) => { expensesMap.set(m.key, 0); subsMap.set(m.key, 0); });

      state.expenses.forEach((e) => {
        const d = new Date(e.date);
        const k = monthKey(d);
        if (expensesMap.has(k)) {
          expensesMap.set(k, expensesMap.get(k) + Number(e.amount || 0));
        }
      });

      state.subscriptions.forEach((s) => {
        if (s.status !== 'active') return;
        const next = new Date(s.next);
        const k = monthKey(next);
        let monthly = Number(s.amount || 0);
        if (s.billing === 'yearly') monthly = monthly / 12;
        if (s.billing === 'weekly') monthly = monthly * 4.345; // approx
        if (subsMap.has(k)) subsMap.set(k, subsMap.get(k) + monthly);
      });

      return {
        labels: months.map((m) => m.label),
        expenses: months.map((m) => expensesMap.get(m.key)),
        subs: months.map((m) => subsMap.get(m.key)),
      };
    }

    function getCategoryDataCurrentMonth() {
      const now = new Date();
      const m = now.getMonth();
      const y = now.getFullYear();
      const map = new Map();

      state.expenses.forEach((e) => {
        const d = new Date(e.date);
        if (d.getMonth() === m && d.getFullYear() === y) {
          const key = e.category || 'Other';
          map.set(key, (map.get(key) || 0) + Number(e.amount || 0));
        }
      });

      state.subscriptions.forEach((s) => {
        if (s.status !== 'active') return;
        const next = new Date(s.next);
        if (next.getMonth() === m && next.getFullYear() === y) {
          let monthly = Number(s.amount || 0);
          if (s.billing === 'yearly') monthly = monthly / 12;
          if (s.billing === 'weekly') monthly = monthly * 4.345;
          const key = s.category || 'Other';
          map.set(key, (map.get(key) || 0) + monthly);
        }
      });

      const labels = Array.from(map.keys());
      const data = Array.from(map.values());
      return { labels, data };
    }

    function initCharts() {
      const ctx1 = document.getElementById('spendingChart').getContext('2d');
      const ctx2 = document.getElementById('categoryChart').getContext('2d');

      const monthly = getMonthlyData();

      spendingChart = new Chart(ctx1, {
        type: 'line',
        data: {
          labels: monthly.labels,
          datasets: [
            {
              label: 'Expenses',
              data: monthly.expenses,
              borderColor: 'rgb(52, 211, 153)',
              backgroundColor: 'rgba(16, 185, 129, 0.18)',
              tension: 0.4,
              fill: true,
              borderWidth: 2,
              pointRadius: 3,
              pointBackgroundColor: 'rgb(16, 185, 129)',
            },
            {
              label: 'Subscriptions (mo)',
              data: monthly.subs,
              borderColor: 'rgb(56, 189, 248)',
              backgroundColor: 'rgba(56, 189, 248, 0.16)',
              tension: 0.4,
              fill: true,
              borderWidth: 2,
              pointRadius: 3,
              pointBackgroundColor: 'rgb(56, 189, 248)',
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: 'rgb(15, 23, 42)',
              borderColor: 'rgb(51, 65, 85)',
              borderWidth: 1,
              padding: 10,
              displayColors: true,
              callbacks: {
                label: (ctx) => `${ctx.dataset.label}: ${formatCurrency(ctx.parsed.y || 0)}`,
              },
            },
          },
          scales: {
            x: {
              grid: { color: 'rgba(30, 41, 59, 0.7)' },
              ticks: { color: 'rgb(148, 163, 184)', font: { size: 10 } },
            },
            y: {
              grid: { color: 'rgba(30, 41, 59, 0.8)' },
              ticks: {
                color: 'rgb(148, 163, 184)', font: { size: 10 },
                callback: (v) => '$' + v,
              },
            },
          },
        },
      });

      const cat = getCategoryDataCurrentMonth();
      categoryChart = new Chart(ctx2, {
        type: 'doughnut',
        data: {
          labels: cat.labels,
          datasets: [
            {
              data: cat.data,
              backgroundColor: [
                'rgba(16, 185, 129, 0.75)',
                'rgba(56, 189, 248, 0.75)',
                'rgba(129, 140, 248, 0.75)',
                'rgba(251, 146, 60, 0.75)',
                'rgba(244, 114, 182, 0.75)',
                'rgba(52, 211, 153, 0.7)',
                'rgba(96, 165, 250, 0.75)',
              ],
              borderWidth: 0,
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: 'rgb(15, 23, 42)',
              borderColor: 'rgb(51, 65, 85)',
              borderWidth: 1,
              padding: 8,
              callbacks: {
                label: (ctx) => `${ctx.label}: ${formatCurrency(ctx.parsed || 0)}`,
              },
            },
          },
        },
      });
    }

    function refreshCharts() {
      if (!spendingChart || !categoryChart) return;
      const monthly = getMonthlyData();
      spendingChart.data.labels = monthly.labels;
      spendingChart.data.datasets[0].data = monthly.expenses;
      spendingChart.data.datasets[1].data = monthly.subs;
      spendingChart.update();

      const cat = getCategoryDataCurrentMonth();
      categoryChart.data.labels = cat.labels;
      categoryChart.data.datasets[0].data = cat.data;
      categoryChart.update();
    }

    // Rendering metrics & tables
    function renderOverviewMetrics() {
      const now = new Date();
      const m = now.getMonth();
      const y = now.getFullYear();

      let monthTotal = 0;
      let prevMonthTotal = 0;
      let todayTotal = 0;
      let todayCount = 0;
      let todayMax = 0;

      state.expenses.forEach((e) => {
        const d = new Date(e.date);
        const amt = Number(e.amount || 0);
        if (d.getFullYear() === y && d.getMonth() === m) monthTotal += amt;
        if (d.getFullYear() === y && d.getMonth() === m - 1) prevMonthTotal += amt;
        if (d.toISOString().slice(0,10) === todayISO()) {
          todayTotal += amt;
          todayCount += 1;
          if (amt > todayMax) todayMax = amt;
        }
      });

      const totalSpentRange = state.expenses.reduce((s, e) => s + Number(e.amount || 0), 0);

      const daysInMonth = new Date(y, m + 1, 0).getDate();
      const avgPerDay = monthTotal / daysInMonth;

      const change = prevMonthTotal ? ((monthTotal - prevMonthTotal) / prevMonthTotal) * 100 : 0;

      document.getElementById('heroMonthSpent').textContent = formatCurrency(monthTotal).replace('$', '$');
      document.getElementById('metric-total-spent').textContent = formatCurrency(totalSpentRange);
      document.getElementById('metric-avg-day').textContent = formatCurrency(avgPerDay);
      const changeEl = document.getElementById('monthChangeLabel');
      changeEl.textContent = (change >= 0 ? '+' : '') + change.toFixed(1) + '%';

      document.getElementById('todaySpentLabel').textContent = formatCurrency(todayTotal);
      document.getElementById('todayCountLabel').textContent = todayCount;
      document.getElementById('todayLargestLabel').textContent = formatCurrency(todayMax);
    }

    function renderSubscriptionsOverview() {
      const heroSubCountEl = document.getElementById('heroSubCount');
      const heroSubTotalEl = document.getElementById('heroSubTotal');
      const overviewSubsBody = document.getElementById('overviewSubsBody');
      const metricUpcomingCount = document.getElementById('metric-upcoming-count');
      const metricUpcomingTotal = document.getElementById('metric-upcoming-total');

      const activeSubs = state.subscriptions.filter((s) => s.status === 'active');
      const count = activeSubs.length;
      let monthlyTotal = 0;

      activeSubs.forEach((s) => {
        let monthly = Number(s.amount || 0);
        if (s.billing === 'yearly') monthly = monthly / 12;
        if (s.billing === 'weekly') monthly = monthly * 4.345;
        monthlyTotal += monthly;
      });

      heroSubCountEl.textContent = count;
      heroSubTotalEl.textContent = monthlyTotal.toFixed(0);

      // Upcoming within 30 days
      const now = new Date();
      const in30 = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);
      let upcomingCount = 0;
      let upcomingTotal = 0;

      activeSubs.forEach((s) => {
        const d = new Date(s.next);
        if (d >= now && d <= in30) {
          upcomingCount++;
          upcomingTotal += Number(s.amount || 0);
        }
      });

      metricUpcomingCount.textContent = upcomingCount;
      metricUpcomingTotal.textContent = upcomingTotal.toFixed(0);

      // Top subs list
      const top = [...activeSubs].sort((a, b) => b.amount - a.amount).slice(0, 8);
      overviewSubsBody.innerHTML = top
        .map((s) => {
          const cycle = s.billing === 'monthly' ? 'mo' : s.billing === 'yearly' ? 'yr' : 'wk';
          return `<tr class="hover:bg-slate-900/60">
            <td class="px-4 py-2.5 text-[11px] text-slate-100">${s.name}</td>
            <td class="px-2 py-2.5 text-right text-[11px] text-slate-100">${formatCurrency(Number(s.amount || 0))}</td>
            <td class="px-2 py-2.5 text-[11px] text-slate-400">${cycle}</td>
          </tr>`;
        })
        .join('');
    }

    function renderBudget() {
      const budgetInput = document.getElementById('budgetInput');
      const metricBudgetUsed = document.getElementById('metric-budget-used');
      const metricBudgetTotal = document.getElementById('metric-budget-total');
      const metricBudgetBar = document.getElementById('metric-budget-bar');
      const budgetRing = document.getElementById('budgetRing');
      const budgetRingLabel = document.getElementById('budgetRingLabel');

      budgetInput.value = state.budget;

      const now = new Date();
      const m = now.getMonth();
      const y = now.getFullYear();
      let monthTotal = 0;
      state.expenses.forEach((e) => {
        const d = new Date(e.date);
        if (d.getFullYear() === y && d.getMonth() === m) monthTotal += Number(e.amount || 0);
      });

      const pct = state.budget ? Math.min(999, (monthTotal / state.budget) * 100) : 0;
      metricBudgetUsed.textContent = pct.toFixed(0) + '%';
      metricBudgetTotal.textContent = state.budget.toFixed(0);
      const clamped = Math.min(100, pct);
      metricBudgetBar.style.width = clamped + '%';

      const circumference = 2 * Math.PI * 16; // r = 16
      const offset = circumference - (Math.min(100, pct) / 100) * circumference;
      budgetRing.setAttribute('stroke-dasharray', circumference);
      budgetRing.setAttribute('stroke-dashoffset', offset);
      budgetRingLabel.textContent = clamped.toFixed(0) + '%';
    }

    function renderRecentExpenses() {
      const body = document.getElementById('recentExpensesBody');
      const sorted = [...state.expenses].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 10);
      body.innerHTML = sorted
        .map((e) => {
          return `<tr class="hover:bg-slate-900/60">
            <td class="px-4 py-2.5 text-[11px] text-slate-300">${e.date}</td>
            <td class="px-2 py-2.5 text-[11px] text-slate-100">${e.description}</td>
            <td class="px-2 py-2.5 text-[11px]"><span class="inline-flex px-1.5 py-0.5 rounded-full bg-slate-900/90 border border-slate-700/80 text-[10px] text-slate-200">${e.category || 'General'}</span></td>
            <td class="px-2 py-2.5 text-[11px] text-right text-slate-100">${formatCurrency(Number(e.amount || 0))}</td>
            <td class="px-2 py-2.5 text-[11px] text-slate-400">${e.method || ''}</td>
          </tr>`;
        })
        .join('');
    }

    function renderExpensesTable() {
      const tbody = document.getElementById('expensesTableBody');
      const catFilter = document.getElementById('expensesCategoryFilter').value;
      const timeFilter = document.getElementById('expensesTimeFilter').value;
      const now = new Date();

      const filtered = state.expenses.filter((e) => {
        const d = new Date(e.date);
        if (catFilter !== 'all' && e.category !== catFilter) return false;
        if (timeFilter === 'month') {
          return d.getFullYear() === now.getFullYear() && d.getMonth() === now.getMonth();
        } else if (timeFilter === '3months') {
          const threeMonthsAgo = new Date(now.getFullYear(), now.getMonth() - 3, now.getDate());
          return d >= threeMonthsAgo && d <= now;
        } else if (timeFilter === 'year') {
          return d.getFullYear() === now.getFullYear();
        }
        return true;
      });

      const rows = filtered
        .sort((a, b) => new Date(b.date) - new Date(a.date))
        .map((e) => {
          return `<tr class="hover:bg-slate-900/60">
            <td class="px-4 py-2.5 text-[11px] text-slate-300">${e.date}</td>
            <td class="px-2 py-2.5 text-[11px] text-slate-100">${e.description}</td>
            <td class="px-2 py-2.5 text-[11px] text-slate-200">${e.category || 'General'}</td>
            <td class="px-2 py-2.5 text-[11px] text-right text-slate-100">${formatCurrency(Number(e.amount || 0))}</td>
            <td class="px-2 py-2.5 text-[11px] text-slate-400">${e.method || ''}</td>
            <td class="px-2 py-2.5 text-[11px] text-slate-500">${e.notes || ''}</td>
          </tr>`;
        })
        .join('');
      tbody.innerHTML = rows || `<tr><td colspan="6" class="px-4 py-3 text-center text-[11px] text-slate-500">No expenses yet. Add one to get started.</td></tr>`;
    }

    function renderSubsTable() {
      const tbody = document.getElementById('subsTableBody');
      const statusFilter = document.getElementById('subsStatusFilter').value;
      const filtered = state.subscriptions.filter((s) => {
        if (statusFilter === 'all') return true;
        return s.status === statusFilter;
      });

      const rows = filtered
        .sort((a, b) => new Date(a.next) - new Date(b.next))
        .map((s) => {
          const cycleLabel = s.billing === 'monthly' ? 'Monthly' : s.billing === 'yearly' ? 'Yearly' : 'Weekly';
          const statusColor = s.status === 'active' ? 'bg-emerald-500/15 text-emerald-200 border-emerald-500/40' : s.status === 'paused' ? 'bg-amber-500/15 text-amber-200 border-amber-500/40' : 'bg-slate-700/30 text-slate-200 border-slate-500/40';
          return `<tr class="hover:bg-slate-900/60">
            <td class="px-4 py-2.5 text-[11px] text-slate-100">${s.name}</td>
            <td class="px-2 py-2.5 text-[11px] text-slate-200">${s.category || 'Other'}</td>
            <td class="px-2 py-2.5 text-[11px] text-right text-slate-100">${formatCurrency(Number(s.amount || 0))}</td>
            <td class="px-2 py-2.5 text-[11px] text-slate-400">${cycleLabel}</td>
            <td class="px-2 py-2.5 text-[11px] text-slate-300">${s.next}</td>
            <td class="px-2 py-2.5 text-[11px]"><span class="inline-flex px-1.5 py-0.5 rounded-full border ${statusColor} text-[10px] capitalize">${s.status}</span></td>
          </tr>`;
        })
        .join('');
      tbody.innerHTML = rows || `<tr><td colspan="6" class="px-4 py-3 text-center text-[11px] text-slate-500">No subscriptions yet. Add one to see it here.</td></tr>`;
    }

    function populateCategoryFilter() {
      const select = document.getElementById('expensesCategoryFilter');
      const cats = new Set(state.expenses.map((e) => e.category || 'General'));
      const options = ['<option value="all">All categories</option>'];
      Array.from(cats).sort().forEach((c) => {
        options.push(`<option value="${c}">${c}</option>`);
      });
      select.innerHTML = options.join('');
    }

    // Modals
    function openModal(id) {
      const el = document.getElementById(id);
      if (!el) return;
      el.classList.remove('hidden');
      el.classList.add('flex');
    }

    function closeModal(id) {
      const el = document.getElementById(id);
      if (!el) return;
      el.classList.add('hidden');
      el.classList.remove('flex');
    }

    function initModals() {
      document.querySelectorAll('[data-close-modal]').forEach((btn) => {
        btn.addEventListener('click', () => closeModal(btn.dataset.closeModal));
      });

      document.getElementById('openExpenseModalBtn').addEventListener('click', () => openModal('expenseModal'));
      document.getElementById('openSubscriptionModalBtn').addEventListener('click', () => openModal('subscriptionModal'));
      document.getElementById('quickAddBtn').addEventListener('click', () => openModal('expenseModal'));
      document.getElementById('addTodayExpenseBtn').addEventListener('click', () => {
        const dateInput = document.getElementById('expenseDate');
        dateInput.value = todayISO();
        openModal('expenseModal');
      });
      document.getElementById('addExpenseFromExpenses').addEventListener('click', () => openModal('expenseModal'));
      document.getElementById('addSubFromSubs').addEventListener('click', () => openModal('subscriptionModal'));

      ['expenseModal', 'subscriptionModal'].forEach((id) => {
        const el = document.getElementById(id);
        el.addEventListener('click', (e) => {
          if (e.target === el) closeModal(id);
        });
      });
    }

    // Forms
    function initForms() {
      const expenseForm = document.getElementById('expenseForm');
      const subscriptionForm = document.getElementById('subscriptionForm');

      // set default dates
      document.getElementById('expenseDate').value = todayISO();
      document.getElementById('subNext').value = todayISO();

      expenseForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const description = document.getElementById('expenseDescription').value.trim();
        const amount = parseFloat(document.getElementById('expenseAmount').value) || 0;
        const date = document.getElementById('expenseDate').value || todayISO();
        const category = document.getElementById('expenseCategory').value || 'General';
        const method = document.getElementById('expenseMethod').value || '';
        const notes = document.getElementById('expenseNotes').value.trim();

        state.expenses.push({ description, amount, date, category, method, notes });
        saveData(state);

        expenseForm.reset();
        document.getElementById('expenseDate').value = todayISO();

        populateCategoryFilter();
        renderAll();
        closeModal('expenseModal');
      });

      subscriptionForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const name = document.getElementById('subName').value.trim();
        const amount = parseFloat(document.getElementById('subAmount').value) || 0;
        const category = document.getElementById('subCategory').value || 'Other';
        const billing = document.getElementById('subBilling').value;
        const next = document.getElementById('subNext').value || todayISO();
        const status = document.getElementById('subStatus').value;

        state.subscriptions.push({ name, amount, category, billing, next, status });
        saveData(state);

        subscriptionForm.reset();
        document.getElementById('subBilling').value = 'monthly';
        document.getElementById('subStatus').value = 'active';
        document.getElementById('subNext').value = todayISO();

        renderAll();
        closeModal('subscriptionModal');
      });

      document.getElementById('budgetInput').addEventListener('change', (e) => {
        const value = parseFloat(e.target.value) || 0;
        state.budget = Math.max(0, value);
        saveData(state);
        renderBudget();
      });
    }

    // Reset data
    function initReset() {
      const btn1 = document.getElementById('resetDataBtn');
      const btn2 = document.getElementById('settingsResetBtn');

      const handler = () => {
        if (!confirm('This will clear all your expenses & subscriptions from this browser. Continue?')) return;
        localStorage.removeItem(STORAGE_KEY);
        state = seedDemoData();
        populateCategoryFilter();
        renderAll();
      };

      btn1.addEventListener('click', handler);
      btn2.addEventListener('click', handler);
    }

    function renderWelcome() {
      const welcomeTitle = document.getElementById('welcomeTitle');
      const todayLabel = document.getElementById('todayLabel');
      const now = new Date();
      const hour = now.getHours();
      const greeting = hour < 12 ? 'Good morning' : hour < 18 ? 'Good afternoon' : 'Good evening';
      welcomeTitle.textContent = greeting;
      todayLabel.textContent = now.toLocaleDateString(undefined, { weekday: 'long', month: 'short', day: 'numeric' });
    }

    function renderAll() {
      renderOverviewMetrics();
      renderSubscriptionsOverview();
      renderBudget();
      renderRecentExpenses();
      renderExpensesTable();
      renderSubsTable();
      refreshCharts();
    }

    window.addEventListener('DOMContentLoaded', () => {
      initNavigation();
      initSidebar();
      initModals();
      initForms();
      initReset();
      populateCategoryFilter();
      initCharts();
      renderWelcome();
      renderAll();

      document.getElementById('expensesCategoryFilter').addEventListener('change', renderExpensesTable);
      document.getElementById('expensesTimeFilter').addEventListener('change', renderExpensesTable);
      document.getElementById('subsStatusFilter').addEventListener('change', renderSubsTable);
    });
  </script>
</body>
</html>
